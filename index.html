<!DOCTYPE HTML>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC FÃºtbol Manager</title>
  <!-- MÃ³vil: <768px carga stylemobil.css -->
<link rel="stylesheet" href="style.css">



</head>
<body>
    <!-- Firebase Config y Injectors -->
    <script type="module" src="./firebase-config.js"></script>
    <script type="module" src="./injector-firebase-sync.js"></script>

        
    <!-- HEADER -->
    <div class="header">
        <div class="header-info">
            <img id="teamLogoHeader" class="team-logo-header" src="" alt="Logo" style="display: none;">
            <div class="info-box">
                <span>Equipo:</span>
                <span id="teamName">-</span>
            </div>
        </div>
        
        <div class="header-title">âš½ PC FÃšTBOL MANAGER</div>
        
        <div class="header-info">
            <div class="info-box">
                <span>Jornada:</span>
                <span id="weekNo">1</span>
            </div>
            <div class="info-box">
                <span>Dinero:</span>
                <span id="balanceDisplay">0â‚¬</span>
            </div>
        </div>
    </div>

    <!-- MAIN LAYOUT - 4 CUADRANTES -->
    <div class="main-layout">
        
        <!-- CUADRANTE SUPERIOR IZQUIERDO: INFORMACIÃ“N -->
        <div class="quadrant top-left">
            <div class="section-title">ðŸ“Š INFORMACIÃ“N</div>
            <button class="menu-button blue-button results-icon" onclick="openPage('dashboard')">Resultados</button>
            <button class="menu-button blue-button classification-icon" onclick="openPage('standings')">ClasificaciÃ³n</button>
            <button class="menu-button blue-button calendar-icon" onclick="openPage('calendar')">Calendario</button>
        </div>

        <!-- CUADRANTE SUPERIOR DERECHO: EQUIPO -->
        <div class="quadrant top-right">
            <div class="section-title">ðŸ‘¥ EQUIPO</div>
            <button class="menu-button green-button lineup-icon" onclick="openPage('lineup')">AlineaciÃ³n</button>
            <button class="menu-button green-button tactics-icon" onclick="openPage('tactics')">TÃ¡ctica</button>
            <button class="menu-button green-button" style="opacity: 0.5; cursor: not-allowed;">Ver Rival</button>
        </div>

        <!-- CUADRANTE INFERIOR IZQUIERDO: FICHAJES -->
        <div class="quadrant bottom-left">
            <div class="section-title">ðŸ”„ FICHAJES</div>
            <button class="menu-button orange-button transfer-icon" onclick="openPage('transfers')">Fichar</button>
            <button class="menu-button orange-button renovation-icon" onclick="openPage('negotiations')">Negociaciones </button>
            <button class="menu-button orange-button squad-icon" onclick="openPage('squad')">Plantilla</button>
            <button class="menu-button orange-button cantera-icon" onclick="openPage('academy')">Cantera</button>
        </div>

        <!-- CUADRANTE INFERIOR DERECHO: GESTIÃ“N -->
        <div class="quadrant bottom-right">
            <div class="section-title">ðŸ’¼ GESTIÃ“N</div>
            <button class="menu-button red-button staff-icon" onclick="openPage('staff')">Empleados</button>
            <button class="menu-button red-button cash-icon" onclick="openPage('finance')">Caja</button>
            <button class="menu-button red-button decisions-icon" onclick="openPage('commercial')">Decisiones</button>
            <button class="menu-button red-button stadium-icon" onclick="openPage('facilities')">Estadio</button>
        </div>

       <!-- FILA CENTRAL PRINCIPAL -->
<div class="main-center-row">

    <!-- BOTONES IZQUIERDA -->
    <div class="center-buttons left">
        <button class="center-option load-btn" onclick="window.openSettingsPage()">â˜ï¸ Cargar Juego</button>
        <button class="center-option save-btn" onclick="window.saveCurrentGame()">ðŸ’¾ Guargar</button>
    </div>

    <!-- CÃRCULO CENTRAL -->
    <div class="main-center-circle">
        <div id="nextMatchInfo">
            <div id="nextMatchDate">-</div>
            <div class="next-match-title">PRÃ“XIMO PARTIDO</div>
            <div id="nextMatchTeams">-</div>
        </div>
    </div>

    <!-- BOTONES DERECHA -->
    <div class="center-buttons right">
        <button class="center-option exit-btn" onclick="window.openModal('gameMode')">Nuevo Juego</button>
        <button class="center-option simulate-btn" onclick="window.simulateWeek()">â© Seguir</button>
    </div>

</div>

    </div>

    <!-- ============================================
         PÃGINAS DE CONTENIDO (Ocultas por defecto)
         ============================================ -->

 <!-- SECCIÃ“N DE SETTINGS OCULTA -->
    <div id="settingsPage" class="page" style="display: none;">
        <div id="settings" class="settings-container">
            <h1>âš™ï¸ Opciones</h1>
            <p>AquÃ­ se cargarÃ¡n las opciones y el botÃ³n de la nube por el injector.</p>
            <!-- injector-cloud-load.js inyectarÃ¡ la secciÃ³n de Cloud Load aquÃ­ -->
        </div>
        <button class="btn" onclick="window.closeSettingsPage()">Cerrar</button>
    </div>
    
    
    <!-- DASHBOARD / RESULTADOS -->
    <div id="dashboard" class="page">
        <div class="page-header">
            <h1>ðŸ“Š Dashboard del Club</h1>
            <button class="page-close-btn" onclick="closePage('dashboard')">âœ– CERRAR</button>
        </div>
        
        <div id="warningAlert" style="display: none;"></div>
        
        <div class="data-grid">
            <div class="data-box">
                <div class="data-label">PosiciÃ³n</div>
                <div class="data-value" id="dashPos">-</div>
            </div>
            <div class="data-box">
                <div class="data-label">Puntos</div>
                <div class="data-value" id="dashPts">0</div>
            </div>
            <div class="data-box">
                <div class="data-label">PJ</div>
                <div class="data-value" id="dashPJ">0</div>
            </div>
            <div class="data-box">
                <div class="data-label">Goles</div>
                <div class="data-value" id="dashGoals">0</div>
            </div>
            <div class="data-box">
                <div class="data-label">Jugadores</div>
                <div class="data-value" id="dashSquad">0</div>
            </div>
            <div class="data-box">
                <div class="data-label">Juveniles</div>
                <div class="data-value" id="dashAcademy">0</div>
            </div>
        </div>
        
      <h2>Estado Financiero</h2>
<table>
    <tr><td>ðŸ’° Dinero en Caja:</td><td id="dashBalance" style="font-weight: bold;">0â‚¬</td></tr>
    <tr style="background: rgba(76, 175, 80, 0.1);"><td>ðŸ“ˆ Ingresos Semanales:</td><td id="dashIncome" style="color: #4CAF50;">0â‚¬</td></tr>
    <tr style="background: rgba(244, 67, 54, 0.1);"><td>ðŸ“‰ Gastos Semanales:</td><td id="dashExpenses" style="color: #f44336;">0â‚¬</td></tr>
    <tr style="border-top: 2px solid #333;"><td><strong>Balance Semanal:</strong></td><td id="dashWeekly" class="data-value" style="font-weight: bold;">+0â‚¬</td></tr>
    
    <tr style="height: 15px;"><td colspan="2"></td></tr>
    
    <tr style="background: rgba(33, 150, 243, 0.1);"><td>ðŸ’¸ Fichajes (temporada):</td><td id="dashPurchases" style="color: #2196F3;">0â‚¬</td></tr>
    <tr style="background: rgba(76, 175, 80, 0.1);"><td>ðŸ’° Ventas (temporada):</td><td id="dashSales" style="color: #4CAF50;">0â‚¬</td></tr>
    <tr style="background: rgba(244, 67, 54, 0.1);"><td>ðŸšª Indemnizaciones:</td><td id="dashCompensations" style="color: #f44336;">0â‚¬</td></tr>
    <tr style="border-top: 2px solid #333;"><td><strong>Balance Transferencias:</strong></td><td id="dashTransferBalance" style="font-weight: bold;">+0â‚¬</td></tr>
</table>
        
        <h2>Ãšltimas Noticias</h2>
        <div id="newsFeed">
            <div class="alert alert-info">No hay noticias recientes.</div>
        </div>
    </div>

    <!-- CLASIFICACIÃ“N -->
    <div id="standings" class="page">
        <div class="page-header">
            <h1>ðŸ“ˆ ClasificaciÃ³n Liga</h1>
            <button class="page-close-btn" onclick="closePage('standings')">âœ– CERRAR</button>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>Pos</th><th>Equipo</th><th>PJ</th><th>G</th><th>E</th><th>P</th>
                    <th>GF</th><th>GC</th><th>DG</th><th>Pts</th>
                </tr>
            </thead>
            <tbody id="standingsTable"></tbody>
        </table>
    </div>

    <!-- CALENDARIO -->
    <div id="calendar" class="page">
        <div class="page-header">
            <h1>ðŸ“… Calendario de Partidos</h1>
            <button class="page-close-btn" onclick="closePage('calendar')">âœ– CERRAR</button>
        </div>
        
        <div id="calendarContent">
            <div class="alert alert-info">AquÃ­ se mostrarÃ¡n los partidos de tu divisiÃ³n.</div>
        </div>
    </div>

  <!-- ALINEACIÃ“N -->
<div id="lineup" class="page">
    <div class="page-header">
        <h1>âš½ AlineaciÃ³n</h1>
        <button class="page-close-btn" onclick="closePage('lineup')">âœ– CERRAR</button>
    </div>
    
    <p class="alert alert-info" id="lineupMessage">
        Arrastra y suelta jugadores para configurar tu alineaciÃ³n. Los jugadores lesionados no pueden ser alineados.
    </p>
    
    <!-- Contenedor horizontal: campo + suplentes -->
    <div class="lineup-main-container">
        <div class="pitch-container" id="pitchContainer">
            <!-- AquÃ­ se renderizarÃ¡n los 11 titulares -->
        </div>
        
        <div class="reserves-container">
            <h2>Suplentes y No Convocados</h2>
            <div class="reserves-list" id="reservesList">
                <!-- AquÃ­ se renderizarÃ¡n los suplentes -->
            </div>
        </div>
    </div>
    
    <button class="btn" style="margin-top: 20px;" onclick="window.saveLineup()">Guardar AlineaciÃ³n</button>
</div>


    <!-- TÃCTICAS -->
<div id="tactics" class="page">
    <div class="page-header">
        <h1>ðŸŽ¯ TÃ¡cticas</h1>
        <button class="page-close-btn" onclick="closePage('tactics')">âœ– CERRAR</button>
    </div>
    
    <div class="form-group" style="margin: 20px 0;">
        <label style="display: block; margin-bottom: 5px;">FormaciÃ³n:</label>
        <select id="formationSelect" onchange="window.updateFormation()">
            <option value="433">4-3-3 Ofensiva</option>
            <option value="442">4-4-2 ClÃ¡sica</option>
            <option value="352">3-5-2 Ultra Ofensiva</option>
            <option value="541">5-4-1 Defensiva</option>
            <option value="451">4-5-1 ContenciÃ³n</option>
        </select>
        
        <label style="display: block; margin-top: 15px; margin-bottom: 5px;">Mentalidad:</label>
        <select id="mentalitySelect" onchange="window.updateMentality()">
            <option value="defensive">Defensiva</option>
            <option value="balanced" selected>Equilibrada</option>
            <option value="offensive">Ofensiva</option>
        </select>
    </div>

    <!-- Campo y banquillo -->
    <div id="tactic-container" style="display: flex; gap: 20px; margin-top: 20px;">
        <div id="tactic-field"></div>
        <div id="tactic-bench">
            <h3>Suplentes</h3>
        </div>
    </div>
</div>

   <!-- MODAL: PONER EN VENTA JUGADOR -->
<div id="sellPlayerModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="window.closeModal('sellPlayer')">&times;</span>
        <h1>ðŸ’° Poner en Venta</h1>
        
        <div id="sellPlayerInfo">
            <h3><span id="sellPlayerName"></span></h3>
            <p>PosiciÃ³n: <span id="sellPlayerPosition"></span> | Edad: <span id="sellPlayerAge"></span> | Overall: <span id="sellPlayerOverall"></span></p>
            <p>Valor de Mercado: <span id="sellPlayerValue"></span>â‚¬</p>
            <p>ClÃ¡usula de RescisiÃ³n: <span id="sellPlayerClause"></span>â‚¬</p>
        </div>
        
        <div class="form-group">
            <label>Tipo de OperaciÃ³n:</label>
            <select id="sellOperationType" onchange="window.updateSellOperationType()">
                <option value="transfer">Venta Definitiva</option>
                <option value="loan">CesiÃ³n</option>
            </select>
        </div>
        
        <!-- VENTA DEFINITIVA -->
        <div id="sellTransferOptions">
            <div class="form-group">
                <label>Precio de Venta:</label>
                <input type="number" id="sellTransferPrice" min="0" step="10000">â‚¬
                <p class="alert alert-info">
                    ðŸ’¡ Precio mÃ­nimo recomendado: <span id="sellMinPrice"></span>â‚¬
                </p>
            </div>
        </div>
        
        <!-- CESIÃ“N -->
        <div id="sellLoanOptions" style="display: none;">
            <div class="form-group">
                <label>% de Salario que Asumimos:</label>
                <input type="range" id="sellLoanWagePercent" min="0" max="100" value="50" 
                       oninput="document.getElementById('sellLoanWageValue').textContent=this.value">
                <span id="sellLoanWageValue">50</span>%
                <p class="alert alert-info">
                    ðŸ“Š Salario actual: <span id="sellPlayerCurrentSalary"></span>â‚¬/sem<br>
                    ðŸ’µ Pagaremos: <span id="sellLoanOurCost"></span>â‚¬/sem<br>
                    ðŸ’° Ellos pagan: <span id="sellLoanTheirCost"></span>â‚¬/sem
                </p>
            </div>
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" onclick="window.confirmListPlayer()">
                âœ… Poner en Venta
            </button>
            <button class="btn" style="background: #666;" onclick="window.closeModal('sellPlayer')">
                âŒ Cancelar
            </button>
        </div>
    </div>
</div>

<!-- MODAL: OFERTA RECIBIDA -->
<div id="offerReceivedModal" class="modal">
    <div class="modal-content">
        <h1>ðŸ“¨ Â¡Oferta Recibida!</h1>
        
        <div class="alert alert-success">
            <p><strong><span id="offerBuyerTeam"></span></strong> estÃ¡ interesado en <strong><span id="offerPlayerName"></span></strong></p>
        </div>
        
        <div id="offerDetails">
            <h3>Detalles de la Oferta:</h3>
            <table style="width: 100%; margin: 20px 0;">
                <tr>
                    <td>Tipo:</td>
                    <td id="offerType" style="font-weight: bold;"></td>
                </tr>
                <tr>
                    <td>Cantidad Ofrecida:</td>
                    <td id="offerAmount" style="font-weight: bold; color: #4CAF50;"></td>
                </tr>
                <tr>
                    <td>Tu Precio Solicitado:</td>
                    <td id="offerAsking" style="font-weight: bold;"></td>
                </tr>
            </table>
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" style="background: #4CAF50;" onclick="window.acceptOffer()">
                âœ… Aceptar Oferta
            </button>
            <button class="btn" style="background: #FF9800;" onclick="window.counterOffer()">
                ðŸ”„ Contraoferta
            </button>
            <button class="btn" style="background: #c73446;" onclick="window.rejectOffer()">
                âŒ Rechazar
            </button>
        </div>
    </div>
</div> 
    
    
    <!-- NEGOCIACIONES / RENOVACIONES -->
<div id="negotiations" class="page">
    <div class="page-header">
        <h1>ðŸ“ Renovaciones de Contratos</h1>
        <button class="page-close-btn" onclick="closePage('negotiations')">âœ– CERRAR</button>
    </div>
    
    <div class="alert alert-info">
        ðŸ’¡ AquÃ­ puedes renovar contratos de tus jugadores actuales. Ten especial atenciÃ³n a los que tienen menos de 2 aÃ±os restantes.
    </div>
    
    <div id="negotiationsSquadList">
        <!-- Se llenarÃ¡ dinÃ¡micamente -->
    </div>
</div>

<!-- MODAL: RENOVACIÃ“N DE CONTRATO -->
<div id="renewalModal" class="modal">
    <div class="modal-content">
        <span class="modal-close" onclick="window.closeModal('renewal')">&times;</span>
        <h1>ðŸ“ RenovaciÃ³n de Contrato</h1>
        
        <div class="renewal-player-info">
            <h3><span id="renewalPlayerName"></span></h3>
            <p>PosiciÃ³n: <span id="renewalPlayerPosition"></span> | Edad: <span id="renewalPlayerAge"></span> | Overall: <span id="renewalPlayerOverall"></span></p>
        </div>
        
        <h3>Contrato Actual:</h3>
        <table style="width: 100%; margin-bottom: 20px;">
            <tr>
                <td>AÃ±os Restantes:</td>
                <td id="renewalCurrentYears" style="font-weight: bold;"></td>
            </tr>
            <tr>
                <td>Salario Actual:</td>
                <td id="renewalCurrentSalary" style="font-weight: bold;"></td>
            </tr>
            <tr>
                <td>ClÃ¡usula Actual:</td>
                <td id="renewalCurrentClause" style="font-weight: bold;"></td>
            </tr>
        </table>
        
        <h3>Propuesta de RenovaciÃ³n:</h3>
        <div class="form-group">
            <label>DuraciÃ³n del Contrato:</label>
            <select id="renewalNewYears">
                <option value="1">1 aÃ±o</option>
                <option value="2">2 aÃ±os</option>
                <option value="3" selected>3 aÃ±os</option>
                <option value="4">4 aÃ±os</option>
                <option value="5">5 aÃ±os</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Nuevo Salario Semanal:</label>
            <input type="number" id="renewalNewSalary" min="0" step="100">â‚¬
            <p class="alert alert-warning" id="renewalSalaryWarning" style="display: none;">
                âš ï¸ El jugador podrÃ­a rechazar si el salario es muy bajo
            </p>
        </div>
        
        <div class="form-group">
            <label>Nueva ClÃ¡usula de RescisiÃ³n:</label>
            <input type="number" id="renewalNewClause" min="0" step="10000">â‚¬
        </div>
        
        <div class="form-group">
            <label><input type="checkbox" id="renewalBonus"> Prima de Fichaje (mejora aceptaciÃ³n)</label>
            <label><input type="checkbox" id="renewalCar"> Coche de Empresa</label>
            <label><input type="checkbox" id="renewalHouse"> Casa Pagada</label>
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" onclick="window.submitRenewalOffer()">
                âœ… Enviar Oferta
            </button>
            <button class="btn" style="background: #666;" onclick="window.closeModal('renewal')">
                âŒ Cancelar
            </button>
        </div>
    </div>
</div>

    
    <!-- MERCADO / FICHAJES -->
    <div id="transfers" class="page">
        <div class="page-header">
            <h1>ðŸ”„ Mercado de Fichajes</h1>
            <button class="page-close-btn" onclick="closePage('transfers')">âœ– CERRAR</button>
        </div>
        
        <div class="alert alert-info">ðŸ’¡ Busca talentos jÃ³venes para comprar barato y revender caro, o refuerza tu equipo.</div>
        
        <h2>Buscar Jugadores</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
            <input type="text" id="marketSearchName" placeholder="Nombre del jugador" style="width: 150px;">
            <select id="marketPosition" style="width: 120px;">
                <option value="ALL">PosiciÃ³n</option>
            </select>
            <input type="number" id="marketMinOverall" placeholder="Media min." min="1" max="99" style="width: 100px;">
            <input type="number" id="marketMaxAge" placeholder="Edad max." min="16" max="40" style="width: 100px;">
            <label style="display:flex; align-items:center; gap: 5px;">
                <input type="checkbox" id="marketTransferListed" style="width:auto;"> Transferibles
            </label>
            <label style="display:flex; align-items:center; gap: 5px;">
                <input type="checkbox" id="marketLoanListed" style="width:auto;"> Cedibles
            </label>
            <button class="btn btn-sm" onclick="window.searchPlayersMarket()">Buscar</button>
            <button class="btn btn-sm" onclick="window.clearPlayerMarketFilters()" style="background: #c73446;">Limpiar</button>
        </div>
        
        <div id="availablePlayersSearchResult" style="margin-top: 20px;">
            <div class="alert alert-info">Utiliza los filtros de bÃºsqueda para encontrar jugadores.</div>
        </div>
        
        <h2>Contratar JÃ³venes de Cantera</h2>
        <div id="availableYoungstersList" style="margin-top: 20px;"></div>
    </div>

    <!-- PLANTILLA -->
    <div id="squad" class="page">
        <div class="page-header">
            <h1>ðŸ‘¥ Plantilla</h1>
            <button class="page-close-btn" onclick="closePage('squad')">âœ– CERRAR</button>
        </div>
        
        <div id="squadList" style="margin-top: 20px;"></div>
    </div>

    <!-- CANTERA -->
    <div id="academy" class="page">
        <div class="page-header">
            <h1>ðŸŽ“ Academia y Cantera</h1>
            <button class="page-close-btn" onclick="closePage('academy')">âœ– CERRAR</button>
        </div>
        
        <button class="btn" onclick="window.openModal('signYoungster')">+ Contratar Joven de Mercado</button>
        <div id="academyList" style="margin-top: 20px;"></div>
    </div>

    <!-- STAFF / EMPLEADOS -->
    <div id="staff" class="page">
        <div class="page-header">
            <h1>ðŸ‘” Personal del Club</h1>
            <button class="page-close-btn" onclick="closePage('staff')">âœ– CERRAR</button>
        </div>
        
        <table>
            <thead>
                <tr><th>Rol</th><th>Nombre</th><th>Nivel</th><th>Salario</th><th>ClÃ¡usula</th><th>Acciones</th></tr>
            </thead>
            <tbody>
                <tr><td>ðŸ¥ MÃ©dico</td><td id="staffMedicoName"></td><td id="staffMedicoLevel"></td><td id="staffMedicoSalary"></td><td id="staffMedicoClausula"></td><td><button class="btn btn-sm" id="btnHireMedico" onclick="window.openHireStaffModal('medico')"></button></td></tr>
                <tr><td>ðŸ§ª Entrenador FÃ­sico</td><td id="staffEntrenadorName"></td><td id="staffEntrenadorLevel"></td><td id="staffEntrenadorSalary"></td><td id="staffEntrenadorClausula"></td><td><button class="btn btn-sm" id="btnHireEntrenador" onclick="window.openHireStaffModal('entrenador')"></button></td></tr>
                <tr><td>âš½ Entrenador Porteros</td><td id="staffEntrenadorPorterosName"></td><td id="staffEntrenadorPorterosLevel"></td><td id="staffEntrenadorPorterosSalary"></td><td id="staffEntrenadorPorterosClausula"></td><td><button class="btn btn-sm" id="btnHireEntrenadorPorteros" onclick="window.openHireStaffModal('entrenadorPorteros')"></button></td></tr>
                <tr><td>ðŸ©¹ Fisioterapeuta</td><td id="staffFisioName"></td><td id="staffFisioLevel"></td><td id="staffFisioSalary"></td><td id="staffFisioClausula"></td><td><button class="btn btn-sm" id="btnHireFisio" onclick="window.openHireStaffModal('fisio')"></button></td></tr>
                <tr><td>ðŸŽ¬ Analista VÃ­deo</td><td id="staffAnalistaName"></td><td id="staffAnalistaLevel"></td><td id="staffAnalistaSalary"></td><td id="staffAnalistaClausula"></td><td><button class="btn btn-sm" id="btnHireAnalista" onclick="window.openHireStaffModal('analista')"></button></td></tr>
                <tr><td>ðŸ” Ojeador</td><td id="staffScoutName"></td><td id="staffScoutLevel"></td><td id="staffScoutSalary"></td><td id="staffScoutClausula"></td><td><button class="btn btn-sm" id="btnHireScout" onclick="window.openHireStaffModal('scout')"></button></td></tr>
                <tr><td>âœï¸ Secretario TÃ©cnico</td><td id="staffSecretarioName"></td><td id="staffSecretarioLevel"></td><td id="staffSecretarioSalary"></td><td id="staffSecretarioClausula"></td><td><button class="btn btn-sm" id="btnHireSecretario" onclick="window.openHireStaffModal('secretario')"></button></td></tr>
                <tr><td>ðŸ§‘â€ðŸ« Segundo Entrenador</td><td id="staffSegundoEntrenadorName"></td><td id="staffSegundoEntrenadorLevel"></td><td id="staffSegundoEntrenadorSalary"></td><td id="staffSegundoEntrenadorClausula"></td><td><button class="btn btn-sm" id="btnHireSegundoEntrenador" onclick="window.openHireStaffModal('segundoEntrenador')"></button></td></tr>
            </tbody>
        </table>
    </div>

    <!-- FINANZAS / CAJA -->
    <div id="finance" class="page">
        <div class="page-header">
            <h1>ðŸ’¼ Finanzas</h1>
            <button class="page-close-btn" onclick="closePage('finance')">âœ– CERRAR</button>
        </div>
        
        <div class="data-grid">
            <div class="data-box">
                <div class="data-label">Ingresos/Semana</div>
                <div class="data-value" id="financeWeeklyIncome">0â‚¬</div>
            </div>
            <div class="data-box">
                <div class="data-label">Gastos/Semana</div>
                <div class="data-value negative" id="financeWeeklyExpenses">0â‚¬</div>
            </div>
            <div class="data-box">
                <div class="data-label">Balance Actual</div>
                <div class="data-value" id="financeBalance">0â‚¬</div>
            </div>
        </div>
        
        <h2>Detalle de Ingresos</h2>
        <table>
            <tr><td>Capacidad Estadio:</td><td id="financeStadiumCapacity">0</td></tr>
            <tr><td>Asistencia Esperada:</td><td id="financeExpectedAttendance">0</td></tr>
            <tr><td>Precio Entrada:</td><td><input type="number" id="ticketPriceInput" min="5" max="100" onchange="window.setTicketPriceFromInput()">â‚¬</td></tr>
            <tr><td>Popularidad del Club:</td><td id="financePopularity">0%</td></tr>
            <tr><td>Fanbase:</td><td id="financeFanbase">0</td></tr>
            <tr><td>Merchandising vendido:</td><td id="financeMerchandisingItemsSold">0</td></tr>
            <tr><td>Precio Merchandising:</td><td><input type="number" id="merchandisingPriceInput" min="1" max="50" onchange="window.setMerchandisingPriceFromInput()">â‚¬</td></tr>
            <tr><td>Ingresos Merchandising:</td><td id="financeMerchandisingRevenue">0â‚¬</td></tr>
        </table>
    </div>

    <!-- COMERCIAL / DECISIONES -->
    <div id="commercial" class="page">
        <div class="page-header">
            <h1>ðŸ›’ GestiÃ³n Comercial</h1>
            <button class="page-close-btn" onclick="closePage('commercial')">âœ– CERRAR</button>
        </div>
        
        <div class="data-grid">
            <div class="data-box">
                <div class="data-label">Popularidad del Club</div>
                <div class="data-value" id="commercialPopularity">0%</div>
            </div>
            <div class="data-box">
                <div class="data-label">Base de Fans</div>
                <div class="data-value" id="commercialFanbase">0</div>
            </div>
            <div class="data-box">
                <div class="data-label">Merchandising Vendido (semana)</div>
                <div class="data-value" id="commercialItemsSold">0</div>
            </div>
            <div class="data-box">
                <div class="data-label">Ingresos Merchandising (semana)</div>
                <div class="data-value" id="commercialMerchRevenue">0â‚¬</div>
            </div>
        </div>
        
        <h2>Ajustes Comerciales</h2>
        <p>Ajusta el precio de tus entradas y merchandising para maximizar beneficios. Ten en cuenta que precios muy altos pueden reducir la popularidad y la asistencia.</p>
        
        <div style="margin-top: 20px;">
            <label style="display: block; margin-bottom: 5px;">Precio de la Entrada (actual: <span id="currentTicketPrice">0</span>â‚¬):</label>
            <input type="range" id="ticketPriceSlider" min="5" max="100" value="20" oninput="window.updateTicketPriceDisplay(this.value)" onchange="window.setTicketPriceFromSlider(this.value)">
            <span id="ticketPriceSliderValue">20</span>â‚¬
        </div>
        
        <div style="margin-top: 15px;">
            <label style="display: block; margin-bottom: 5px;">Precio del Merchandising (actual: <span id="currentMerchandisingPrice">0</span>â‚¬):</label>
            <input type="range" id="merchandisingPriceSlider" min="1" max="50" value="10" oninput="window.updateMerchandisingPriceDisplay(this.value)" onchange="window.setMerchandisingPriceFromSlider(this.value)">
            <span id="merchandisingPriceSliderValue">10</span>â‚¬
        </div>
    </div>

    <!-- INSTALACIONES / ESTADIO -->
    <div id="facilities" class="page">
        <div class="page-header">
            <h1>ðŸŸï¸ Instalaciones</h1>
            <button class="page-close-btn" onclick="closePage('facilities')">âœ– CERRAR</button>
        </div>
        
        <!-- SecciÃ³n del Estadio -->
        <div class="facility-section">
            <h2>Estadio</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <p style="margin-bottom: 10px;"><strong>Nombre:</strong> <span id="stadiumNameDisplay" style="color: #00ff00;">-</span></p>
                    <p style="margin-bottom: 10px;"><strong>Capacidad actual:</strong> <span id="currentStadiumCapacity" style="color: #00ff00;">0</span> espectadores</p>
                    <button class="btn" onclick="window.expandStadium()">Expandir Estadio (+10.000 asientos - 50.000â‚¬)</button>
                </div>
                <div id="stadiumImageContainer" style="text-align: center;">
                    <p style="color: #999;">No hay imagen del estadio disponible</p>
                </div>
            </div>
        </div>
        
        <!-- SecciÃ³n del Centro de Entrenamiento -->
        <div class="facility-section">
            <h2>Centro de Entrenamiento</h2>
            <p style="margin-bottom: 15px;"><strong>Nivel actual:</strong> <span id="currentTrainingLevel" style="color: #00ff00; font-size: 1.5em;">1</span></p>
            <p style="color: #999; margin-bottom: 15px; font-size: 0.9em;">Un mejor centro de entrenamiento mejora la efectividad de los entrenamientos individuales</p>
            <button class="btn" onclick="window.improveFacilities()">Mejorar Entrenamientos (30.000â‚¬)</button>
        </div>
    </div>

    <!-- ============================================
         MODALES (mantienen la misma estructura)
         ============================================ -->

    <!-- MODAL: SelecciÃ³n de Modo de Juego -->
    <div id="gameModeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal('gameMode')">&times;</span>
            <h1>Modo de Juego</h1>
            <button class="btn" style="width: 100%; padding: 20px; margin-top: 20px;" onclick="window.startGameMode('manager')">ðŸ… Liga Manager (Empezar con equipo preexistente)</button>
            <button class="btn" style="width: 100%; padding: 20px; margin-top: 20px;" onclick="window.startGameMode('promanager')">ðŸš€ Liga Promanager (Empezar desde abajo)</button>
        </div>
    </div>

        <!-- MODAL: SelecciÃ³n de Equipo -->
    <div id="selectTeamModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal('selectTeam')">&times;</span>
            <h1>Selecciona tu Equipo</h1>
            <h2>Primera DivisiÃ³n</h2>
            <div id="primeraList" class="team-selection-list"></div>
            <h2>Segunda DivisiÃ³n</h2>
            <div id="segundaList" class="team-selection-list"></div>
            <h2>Primera RFEF Grupo 1</h2>
            <div id="rfef_grupo1List" class="team-selection-list"></div>
            <h2>Primera RFEF Grupo 2</h2>
            <div id="rfef_grupo2List" class="team-selection-list"></div>
        </div>
    </div>

    <!-- MODAL: Contratar Joven -->
    <div id="signYoungsterModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal('signYoungster')">&times;</span>
            <h1>Contratar Joven</h1>
            <div id="availableYoungstersList"></div>
        </div>
    </div>

    <!-- MODAL: NegociaciÃ³n -->
    <div id="negotiationModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.endNegotiationUI(false)">&times;</span>
            <h1>NegociaciÃ³n de Fichajes</h1>
            
            <div class="negotiation-player-info">
                <h3><span id="negotiationPlayerName"></span> (<span id="negotiationPlayerClub"></span>)</h3>
                <p>PosiciÃ³n: <span id="negotiationPlayerPosition"></span> | Edad: <span id="negotiationPlayerAge"></span> | Media: <span id="negotiationPlayerOverall"></span> | Potencial: <span id="negotiationPlayerPotential"></span></p>
                <p>Salario Actual: <span id="negotiationPlayerCurrentSalary"></span>â‚¬/sem | Valor de Mercado: <span id="negotiationPlayerValue"></span>â‚¬</p>
                <p id="negotiationPlayerAskingPrice" style="display: none;"><span style="color: orange; font-weight: bold;">Precio solicitado: <span id="negotiationPlayerAskingPriceValue"></span>â‚¬</span></p>
                <p id="negotiationPlayerLoanInfo" style="display: none;"><span style="color: lightblue; font-weight: bold;">Cedible (club actual paga <span id="negotiationPlayerLoanContribution"></span>â‚¬/sem)</span></p>
            </div>
            
            <!-- PASO 1: Oferta al Jugador -->
            <div id="negotiationStep1" class="negotiation-step">
                <h2>Paso 1: Ofrecer Contrato Personal a <span id="negotiationPlayerNameStep1"></span></h2>
                <label for="offeredSalary">Salario Semanal:</label>
                <input type="number" id="offeredSalary" value="0" min="0" step="100">â‚¬
                
                <div class="negotiation-incentives">
                    <div><input type="checkbox" id="offeredBonus"><label for="offeredBonus">Prima por Fichaje</label></div>
                    <div><input type="checkbox" id="offeredCar"><label for="offeredCar">Coche</label></div>
                    <div><input type="checkbox" id="offeredHouse"><label for="offeredHouse">Casa</label></div>
                    <div><input type="checkbox" id="offeredMerchPercent"><label for="offeredMerchPercent">% Merchandising</label></div>
                    <div><input type="checkbox" id="offeredTicketPercent"><label for="offeredTicketPercent">% Entradas</label></div>
                </div>
                <button class="btn" onclick="window.submitPlayerOffer()">Hacer Oferta al Jugador</button>
                <button class="btn" style="background: #c73446;" onclick="window.endNegotiationUI(false)">Cancelar NegociaciÃ³n</button>
            </div>
            
            <!-- PASO 2: Oferta al Club -->
            <div id="negotiationStep2" class="negotiation-step" style="display: none;">
                <h2>Paso 2: Negociar con el Club <span id="negotiationPlayerClubStep2"></span></h2>
                <p id="negotiationClubMessage"></p>
                
                <!-- Si es cesiÃ³n -->
                <div id="negotiationLoanOffer" style="display: none;">
                    <label for="loanWageContribution">Â¿QuÃ© porcentaje de su salario semanal pagarÃ­as? (Actual: <span id="loanPlayerSalaryExample"></span>â‚¬)</label>
                    <input type="range" id="loanWageContribution" min="0" max="100" value="50" oninput="document.getElementById('loanWageContributionValue').textContent=this.value+'%'">
                    <span id="loanWageContributionValue">50</span>%
                    <p class="alert alert-info">El club de origen paga <span id="loanClubContributionInfo"></span>â‚¬ de su salario actual.</p>
                    <button class="btn" onclick="window.submitLoanOffer()">Hacer Oferta de CesiÃ³n</button>
                </div>
                
                <!-- Si es traspaso -->
                <div id="negotiationTransferOffer" style="display: none;">
                    <label for="offerAmount">Cantidad de Traspaso:</label>
                    <input type="number" id="offerAmount" value="0" min="0" step="1000">â‚¬
                    <label style="margin-top: 15px;">Jugadores a incluir en el intercambio (opcional):</label>
                    <select id="playerExchangeSelect" multiple style="min-height: 100px;"></select>
                    <button class="btn" onclick="window.submitTransferOffer()">Hacer Oferta de Traspaso</button>
                </div>
                <button class="btn" style="background: #c73446; margin-top: 10px;" onclick="window.endNegotiationUI(false)">Cancelar NegociaciÃ³n</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Entrenamiento -->
    <div id="trainingModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal('training')">&times;</span>
            <h1>Entrenamiento Individual</h1>
            
            <div class="training-player-info">
                <h3>Jugador: <span id="trainingPlayerName"></span></h3>
                <p>PosiciÃ³n: <span id="trainingPlayerPosition"></span> | Media: <span id="trainingPlayerOverall"></span> | Potencial: <span id="trainingPlayerPotential"></span></p>
                <p>Atributos actuales:</p>
                <ul id="trainingPlayerAttributes" style="list-style: none; display: flex; flex-wrap: wrap; gap: 10px;"></ul>
            </div>
            
            <p class="alert alert-info" id="trainingInfoMessage">Selecciona un atributo para que <span id="trainingPlayerNameInfo"></span> se enfoque esta semana.</p>
            <div id="trainingStaffWarning" class="alert alert-warning" style="display: none;">
                âš ï¸ Â¡Advertencia! No tienes un entrenador fÃ­sico contratado. El entrenamiento serÃ¡ menos efectivo.
            </div>
            <div id="trainingGkStaffWarning" class="alert alert-warning" style="display: none;">
                âš ï¸ Â¡Advertencia! No tienes un entrenador de porteros contratado. El entrenamiento para POR serÃ¡ menos efectivo.
            </div>
            
            <div class="attribute-selection" style="margin-top: 20px;">
                <p>Seleccionar atributo para entrenar:</p>
                <div id="attributeRadioButtons"></div>
            </div>
            
            <button class="btn" style="margin-top: 20px;" onclick="window.submitTrainingFocus()">Establecer Foco de Entrenamiento</button>
            <button class="btn" style="background: #c73446; margin-top: 20px;" onclick="window.closeModal('training')">Cerrar</button>
        </div>
    </div>

    <!-- MODAL: Contratar Staff -->
    <div id="hireStaffModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal('hireStaff')">&times;</span>
            <h1>Contratar Personal: <span id="staffRoleDisplayName"></span></h1>
            <p>Selecciona un candidato para el puesto de <span id="staffRoleDisplayNameInfo"></span>.</p>
            <div id="staffCandidatesList" style="margin-top: 20px;"></div>
            <button class="btn" style="background: #c73446; margin-top: 20px;" onclick="window.closeModal('hireStaff')">Cancelar</button>
        </div>
    </div>

    <!-- MODAL: Resultado del Partido -->
    <div id="matchResultModal" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 500px; padding: 40px;">
            <h1 id="matchResultTitle" style="color: #00ff00; margin-bottom: 20px;"></h1>
            <div id="matchResultDetails" style="font-size: 1.5em; font-weight: bold;"></div>
            <p id="matchResultMessage" style="margin-top: 20px; font-size: 1.1em; color: #e94560;"></p>
        </div>
    </div>

    <!-- Modal de jugador -->
<!-- Modal de jugador -->
<div id="playerModal" class="player-modal">
    <div class="player-modal-content">
        <span class="player-modal-close" onclick="closePlayerModal()">&times;</span>
        
        <div class="modal-header">
            <img id="modalPlayerPhoto" src="https://via.placeholder.com/120x150?text=Foto" alt="Foto jugador">
            <div class="modal-header-info">
                <h2 id="modalPlayerName">Nombre</h2>
                <p id="modalPlayerPosition">PosiciÃ³n: -</p>
                <p id="modalPlayerOverall">OVR: -</p>
            </div>
        </div>
        
        <div class="modal-body">
            <h3>Personal</h3>
            <p id="modalPlayerPersonal"></p>

            <h3>Atributos</h3>
            <p id="modalPlayerAttributes"></p>

            <h3>Contrato</h3>
            <p id="modalPlayerContract"></p>

            <h3>Status</h3>
            <p id="modalPlayerStatus"></p>

            <h3>Stats</h3>
            <p id="modalPlayerStats"></p>

            <h3>Historial</h3>
            <p id="modalPlayerHistory"></p>
        </div>
    </div>
</div>

   
    <!-- SCRIPTS DEL JUEGO -->
    <script type="module">
        
        import * as gameLogic from './gameLogic.js';
        import * as ui from './ui.js';
        import { TEAMS_DATA, FORMATIONS, POSITIONS, ATTRIBUTES, STAFF_ROLES, PRESEASON_WEEKS } from './config.js';
        import { getPlayerMarket, getYoungsterMarket } from './players.js';

        // ============================================
        // FUNCIONES PARA NAVEGACIÃ“N DE PÃGINAS
        // ============================================
        
        window.openPage = function(pageId) {
            const page = document.getElementById(pageId);
            if (page) {
                page.classList.add('active');
                
                // Actualizar contenido segÃºn la pÃ¡gina
                const state = gameLogic.getGameState();
                if (pageId === 'squad') ui.renderSquadList(state.squad, state.team);
                if (pageId === 'academy') ui.renderAcademyList(state.academy);
                if (pageId === 'transfers') {
                    window.searchPlayersMarket();
                    window.renderAvailableYoungsters();
                }
                if (pageId === 'finance') window.updateFinanceDisplay(state);
                if (pageId === 'facilities') window.updateFacilitiesDisplay(state);
                if (pageId === 'commercial') window.updateCommercialDisplay(state);
                if (pageId === 'staff') window.updateStaffDisplay(state);
                if (pageId === 'tactics') window.updateTacticsDisplay(state);
                if (pageId === 'lineup') window.renderLineupPageUI();
                if (pageId === 'dashboard') gameLogic.markNewsAsRead();
                if (pageId === 'calendar') ui.renderCalendarPage(state);
                if (pageId === 'standings') ui.renderStandingsTable(state);
                if (pageId === 'negotiations') ui.renderNegotiationsList(state);
            }
        };
        
        window.closePage = function(pageId) {
            const page = document.getElementById(pageId);
            if (page) {
                page.classList.remove('active');
            }
        };

        window.handleExit = function() {
            if (confirm('Â¿EstÃ¡s seguro de que quieres salir? AsegÃºrate de guardar tu partida antes.')) {
                // AquÃ­ puedes aÃ±adir lÃ³gica de salida o redireccionamiento
                window.location.reload();
            }
        };

        window.openSettingsPage = function() {
            const mainPage = document.getElementById('mainPage');
            const settingsPage = document.getElementById('settingsPage');

            if (mainPage) mainPage.style.display = 'none';
            if (settingsPage) settingsPage.style.display = 'block';

            if (window.injectCloudLoadUI) {
                window.injectCloudLoadUI();
            }
        };

        window.closeSettingsPage = function() {
            const mainPage = document.getElementById('mainPage');
            const settingsPage = document.getElementById('settingsPage');

            if (settingsPage) settingsPage.style.display = 'none';
            if (mainPage) mainPage.style.display = 'grid';
        };

        window.negotiatePlayer = function(playerName) {
            alert(`La funcionalidad "Negociar" para jugadores de tu plantilla no estÃ¡ implementada todavÃ­a.`);
        };

        // Variables y funciones para Drag & Drop
        let draggedPlayer = null;

        window.allowDrop = function(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('highlight');
        };

        window.drag = function(ev, playerJson) {
            const player = JSON.parse(decodeURIComponent(playerJson));
            if (player.isInjured) {
                ev.preventDefault();
                alert("Los jugadores lesionados no pueden ser alineados.");
                return;
            }
            var _dSt = window.gameLogic && window.gameLogic.getGameState();
            var _dSp = _dSt && _dSt.squad && _dSt.squad.find(function(p){ return p.name === player.name; });
            if (_dSp && _dSp.isSuspended) {
                ev.preventDefault();
                alert(player.name + ' esta sancionado (' + (_dSp.suspensionWeeks || 0) + ' jornada/s) y no puede ser alineado.');
                return;
            }
            draggedPlayer = player;
            ev.dataTransfer.setData("text/plain", playerJson);
            ev.dataTransfer.effectAllowed = "move";
        };

        window.drop = function(ev, targetSlotId) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('highlight');

            const state = gameLogic.getGameState();
            let currentLineup = gameLogic.getLineup();
            let currentSquad = state.squad;

            const droppedPlayer = draggedPlayer;
            if (!droppedPlayer || droppedPlayer.isInjured || droppedPlayer.isSuspended) return;

            const isDroppedPlayerInCurrentLineup = currentLineup.some(p => p && p.name === droppedPlayer.name);
            let newProposedLineup = [...currentLineup];

            if (targetSlotId.startsWith('pitch-slot-')) {
                const targetIndex = parseInt(targetSlotId.replace('pitch-slot-', ''));
                const playerAlreadyInTargetSlot = newProposedLineup[targetIndex];

                if (playerAlreadyInTargetSlot && playerAlreadyInTargetSlot.name === droppedPlayer.name) {
                    return;
                }

                if (isDroppedPlayerInCurrentLineup) {
                    const sourceIndex = newProposedLineup.findIndex(p => p && p.name === droppedPlayer.name);
                    if (sourceIndex !== -1) {
                        newProposedLineup[sourceIndex] = playerAlreadyInTargetSlot;
                        newProposedLineup[targetIndex] = droppedPlayer;
                    }
                } else {
                    newProposedLineup[targetIndex] = droppedPlayer;
                }
            } else if (targetSlotId === 'reservesList') {
                if (isDroppedPlayerInCurrentLineup) {
                    const sourceIndex = newProposedLineup.findIndex(p => p && p.name === droppedPlayer.name);
                    if (sourceIndex !== -1) {
                        newProposedLineup[sourceIndex] = null;
                    }
                } else {
                    return;
                }
            }

            const finalLineupPlayers = newProposedLineup.filter(p => p !== null);
            gameLogic.setLineup(finalLineupPlayers);
            window.renderLineupPageUI();
            draggedPlayer = null;
        };

        window.dragleave = function(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('highlight');
        };

        window.openModal = function(type) {        
    if (type === 'gameMode') {        
        document.getElementById('gameModeModal').classList.add('active');        
    } else if (type === 'selectTeam') {        
        document.getElementById('selectTeamModal').classList.add('active');        
        window.renderTeamSelectors(); // <-- Â¡AsegÃºrate de que esta lÃ­nea estÃ© aquÃ­!  
    } else if (type === 'signYoungster') {        
        document.getElementById('signYoungsterModal').classList.add('active');        
        window.renderAvailableYoungsters();        
    } else if (type === 'negotiation') {        
        document.getElementById('negotiationModal').classList.add('active');        
    } else if (type === 'training') {        
        document.getElementById('trainingModal').classList.add('active');        
    } else if (type === 'hireStaff') {        
        document.getElementById('hireStaffModal').classList.add('active');        
    } else if (type === 'matchResult') {        
        document.getElementById('matchResultModal').classList.add('active');        
    }        
};

        window.closeModal = function(type) {
    const modal = document.getElementById(type + 'Modal');
    if (modal) {
        modal.classList.remove('active');
    } else {
        console.warn(`âš ï¸ Modal no encontrado: ${modalId}`);
    }
};
      
       window.startGameMode = function(mode) {        
    window.gameMode = mode;        
    window.closeModal('gameMode');  
    // DESCOMENTA o ASEGÃšRATE de que esta lÃ­nea estÃ© presente:  
    window.renderTeamSelectors(); // ðŸ‘ˆ IMPORTANTE  
    window.openModal('selectTeam');        
};    
      
 
function renderTeamSelectors() {  
    // ComprobaciÃ³n de seguridad: TEAMS_DATA debe existir  
    if (!window.TEAMS_DATA) {  
        console.error('âš ï¸ TEAMS_DATA no estÃ¡ disponible. No se pueden mostrar equipos.');  
        return;  
    }  
  
    const divisions = ['primera', 'segunda', 'rfef_grupo1', 'rfef_grupo2'];  
    const divisionListIds = {  
        'primera': 'primeraList',  
        'segunda': 'segundaList',  
        'rfef_grupo1': 'rfef_grupo1List',  
        'rfef_grupo2': 'rfef_grupo2List'  
    };  
  
    divisions.forEach(divisionKey => {  
        const listElement = document.getElementById(divisionListIds[divisionKey]);  
        if (!listElement) return;  
  
        // MODIFICACIÃ“N: FILTRAR ELEMENTOS NULL/UNDEFINED DEL ARRAY DE EQUIPOS  
        const teamsToRender = (window.TEAMS_DATA[divisionKey] || []).filter(team => team);  
  
        if (teamsToRender.length === 0) {  
            listElement.innerHTML = `<p style="color: #ccc; font-style: italic;">No hay equipos disponibles</p>`;  
            return;  
        }  
  
        // Crear botones para cada equipo  
        listElement.innerHTML = teamsToRender.map(team => {  
            const safeTeam = team.replace(/'/g, "\\'"); // Escapar comillas simples  
            return `  
                <button class="btn" style="width: 100%; margin: 5px 0; background: rgba(233, 69, 96, 0.1); border-color: #e94560; color: #fff;"  
                        onclick="window.selectTeamAndStart('${safeTeam}', '${divisionKey}')">  
                    ${team}  
                </button>  
            `;  
        }).join('');  
    });  
}  
  
// Hacer global para que los modales lo llamen  
window.renderTeamSelectors = renderTeamSelectors;  

// -------------------------
// SelecciÃ³n de equipo y arranque
// -------------------------
window.selectTeamAndStart = function(teamName, division) {
    if (!teamName || !division) {
        alert('âš ï¸ Equipo o divisiÃ³n invÃ¡lidos');
        return;
    }

    console.log('Seleccionando equipo:', teamName, 'Division:', division);

    gameLogic.selectTeamWithInitialSquad(teamName, division, window.gameMode);
    ui.refreshUI(gameLogic.getGameState());
    window.closeModal('selectTeam');

    // Abrir dashboard automÃ¡ticamente
    const dashboardButton = document.querySelector('.menu-item[onclick="window.switchPage(\'dashboard\', this)"]');
    if (dashboardButton) window.switchPage('dashboard', dashboardButton);
};

      

        
        // Funciones de mercado
        window.searchPlayersMarket = function() {
            const filters = {
                searchName: document.getElementById('marketSearchName').value,
                position: document.getElementById('marketPosition').value,
                minOverall: parseInt(document.getElementById('marketMinOverall').value) || 0,
                maxAge: parseInt(document.getElementById('marketMaxAge').value) || 100,
                transferListed: document.getElementById('marketTransferListed').checked,
                loanListed: document.getElementById('marketLoanListed').checked
            };
            const players = gameLogic.getPlayerMarket(filters);
            ui.renderPlayerMarketList(players);
        };

        window.clearPlayerMarketFilters = function() {
            document.getElementById('marketSearchName').value = '';
            document.getElementById('marketPosition').value = 'ALL';
            document.getElementById('marketMinOverall').value = '';
            document.getElementById('marketMaxAge').value = '';
            document.getElementById('marketTransferListed').checked = false;
            document.getElementById('marketLoanListed').checked = false;
            window.searchPlayersMarket();
        };

        function renderAvailableYoungsters() {
            const youngsters = gameLogic.getYoungsterMarket();
            ui.renderAvailableYoungstersMarket(youngsters);
        }
        window.renderAvailableYoungsters = renderAvailableYoungsters;

        window.fichYoungsterConfirm = function(encodedYoungsterJson) {
            const youngster = JSON.parse(decodeURIComponent(encodedYoungsterJson));
            const result = gameLogic.signYoungster(youngster);
            alert(result.message);
            ui.refreshUI(gameLogic.getGameState());
            if (result.success) {
                window.closeModal('signYoungster');
            }
        };

        window.sellPlayerConfirm = function(name) {
            if (confirm(`Â¿EstÃ¡s seguro de que quieres vender a ${name}?`)) {
                const result = gameLogic.sellPlayer(name);
                alert(result.message);
                ui.refreshUI(gameLogic.getGameState());
            }
        };

        window.promoteConfirm = function(name) {
            if (confirm(`Â¿Ascender a ${name} a la primera plantilla?`)) {
                const result = gameLogic.promoteYoungster(name);
                alert(result.message);
                ui.refreshUI(gameLogic.getGameState());
            }
        };

        // SimulaciÃ³n
        window.simulateWeek = async function() {
            const state = gameLogic.getGameState();
            const lineupValidation = gameLogic.validateLineup(state.lineup);
            
            if (!lineupValidation.success) {
                if (state.staff.segundoEntrenador) {
                    alert(`Â¡Advertencia del Segundo Entrenador!\n\nTu alineaciÃ³n actual es INVÃLIDA:\n${lineupValidation.message}\n\nPor favor, corrige la alineaciÃ³n antes de simular la jornada.`);
                    gameLogic.addNews(`[Segundo Entrenador - CRÃTICO] AlineaciÃ³n invÃ¡lida: ${lineupValidation.message}. Por favor, corrige.`, 'error');
                    window.openPage('lineup');
                    return;
                } else {
                    alert(`Â¡AlineaciÃ³n invÃ¡lida detectada!\n\n${lineupValidation.message}\n\nTu equipo serÃ¡ penalizado con una derrota 0-3 por alineaciÃ³n indebida.`);
                    gameLogic.addNews(`[SISTEMA - ATENCIÃ“N] AlineaciÃ³n invÃ¡lida detectada: ${lineupValidation.message}. Derrota 0-3 forzada.`, 'error');
                }
            }
            
            const simulationResult = gameLogic.simulateFullWeek();
            ui.refreshUI(gameLogic.getGameState());

            if (simulationResult && simulationResult.myMatch) {
                const myMatch = simulationResult.myMatch;
                const matchResultTitle = document.getElementById('matchResultTitle');
                const matchResultDetails = document.getElementById('matchResultDetails');
                const matchResultMessage = document.getElementById('matchResultMessage');

                matchResultDetails.innerHTML = `${myMatch.home} ${myMatch.score} ${myMatch.away}`;
                
                if (myMatch.home === state.team) {
                    if (parseInt(myMatch.score.split('-')[0]) > parseInt(myMatch.score.split('-')[1])) {
                        matchResultTitle.textContent = 'Â¡VICTORIA!';
                        matchResultTitle.style.color = '#00ff00';
                    } else if (parseInt(myMatch.score.split('-')[0]) === parseInt(myMatch.score.split('-')[1])) {
                        matchResultTitle.textContent = 'EMPATE';
                        matchResultTitle.style.color = 'orange';
                    } else {
                        matchResultTitle.textContent = 'DERROTA';
                        matchResultTitle.style.color = 'red';
                    }
                } else {
                    if (parseInt(myMatch.score.split('-')[1]) > parseInt(myMatch.score.split('-')[0])) {
                        matchResultTitle.textContent = 'Â¡VICTORIA!';
                        matchResultTitle.style.color = '#00ff00';
                    } else if (parseInt(myMatch.score.split('-')[1]) === parseInt(myMatch.score.split('-')[0])) {
                        matchResultTitle.textContent = 'EMPATE';
                        matchResultTitle.style.color = 'orange';
                    } else {
                        matchResultTitle.textContent = 'DERROTA';
                        matchResultTitle.style.color = 'red';
                    }
                }

                window.openModal('matchResult');
                await new Promise(resolve => setTimeout(resolve, 5000));
                window.closeModal('matchResult');
            }

            window.openPage('dashboard');
        };

        // NegociaciÃ³n
        window.startNegotiationUI = function(encodedPlayerJson) {
            const player = encodedPlayerJson;
            const result = gameLogic.startNegotiation(player);
            if (result.success) {
                window.updateNegotiationModal();
                window.openModal('negotiation');
            } else {
                alert('Error: ' + result.message);
            }
        };

        window.startPlayerNegotiation = window.startNegotiationUI;

        window.updateNegotiationModal = function() {
            const state = gameLogic.getGameState();
            const player = state.negotiatingPlayer;

            if (!player) {
                window.closeModal('negotiation');
                return;
            }

            document.getElementById('negotiationPlayerName').textContent = player.name;
            document.getElementById('negotiationPlayerNameStep1').textContent = player.name;
            document.getElementById('negotiationPlayerClub').textContent = player.club;
            document.getElementById('negotiationPlayerClubStep2').textContent = player.club;
            document.getElementById('negotiationPlayerPosition').textContent = player.position;
            document.getElementById('negotiationPlayerAge').textContent = player.age;
            document.getElementById('negotiationPlayerOverall').textContent = player.overall;
            document.getElementById('negotiationPlayerPotential').textContent = player.potential;
            document.getElementById('negotiationPlayerCurrentSalary').textContent = player.salary.toLocaleString('es-ES');
            document.getElementById('negotiationPlayerValue').textContent = player.value.toLocaleString('es-ES');

            const askingPriceElem = document.getElementById('negotiationPlayerAskingPrice');
            const loanInfoElem = document.getElementById('negotiationPlayerLoanInfo');
            
            if (player.transferListed) {
                askingPriceElem.style.display = 'block';
                document.getElementById('negotiationPlayerAskingPriceValue').textContent = player.askingPrice.toLocaleString('es-ES');
                loanInfoElem.style.display = 'none';
            } else if (player.loanListed) {
                askingPriceElem.style.display = 'none';
                loanInfoElem.style.display = 'block';
                document.getElementById('negotiationPlayerLoanContribution').textContent = (player.loanWageContribution || 0).toLocaleString('es-ES');
            } else {
                askingPriceElem.style.display = 'none';
                loanInfoElem.style.display = 'none';
            }

            document.getElementById('negotiationStep1').style.display = 'none';
            document.getElementById('negotiationStep2').style.display = 'none';

            if (state.negotiationStep === 1) {
                document.getElementById('negotiationStep1').style.display = 'block';
                document.getElementById('offeredSalary').value = player.salary;
                document.getElementById('offeredBonus').checked = false;
                document.getElementById('offeredCar').checked = false;
                document.getElementById('offeredHouse').checked = false;
                document.getElementById('offeredMerchPercent').checked = false;
                document.getElementById('offeredTicketPercent').checked = false;
            } else if (state.negotiationStep === 2) {
                document.getElementById('negotiationStep2').style.display = 'block';

                const negotiationLoanOffer = document.getElementById('negotiationLoanOffer');
                const negotiationTransferOffer = document.getElementById('negotiationTransferOffer');

                negotiationLoanOffer.style.display = 'none';
                negotiationTransferOffer.style.display = 'none';

                document.getElementById('negotiationClubMessage').textContent = `EstÃ¡s a punto de hacer una oferta a ${player.club} por ${player.name}.`;

                if (player.loanListed) {
                    negotiationLoanOffer.style.display = 'block';
                    document.getElementById('loanPlayerSalaryExample').textContent = player.salary.toLocaleString('es-ES');
                    document.getElementById('loanClubContributionInfo').textContent = (player.loanWageContribution || 0).toLocaleString('es-ES');
                    document.getElementById('loanWageContribution').value = 50;
                    document.getElementById('loanWageContributionValue').textContent = '50%';
                } else if (player.transferListed) {
                    negotiationTransferOffer.style.display = 'block';
                    document.getElementById('offerAmount').value = player.askingPrice;
                    window.populatePlayerExchangeSelect();
                }
            }
        };

        window.submitPlayerOffer = function() {
            const offeredSalary = parseInt(document.getElementById('offeredSalary').value);
            const offeredBonus = document.getElementById('offeredBonus').checked;
            const offeredCar = document.getElementById('offeredCar').checked;
            const offeredHouse = document.getElementById('offeredHouse').checked;
            const offeredMerchPercent = document.getElementById('offeredMerchPercent').checked;
            const offeredTicketPercent = document.getElementById('offeredTicketPercent').checked;

            const result = gameLogic.offerToPlayer(offeredSalary, offeredBonus, offeredCar, offeredHouse, offeredMerchPercent, offeredTicketPercent);
            alert(result.message);
            if (result.success) {
                window.updateNegotiationModal();
            } else {
                if (result.message.includes('No estÃ¡ interesado')) {
                    window.endNegotiationUI(false);
                }
            }
        };

        function populatePlayerExchangeSelect() {
            const select = document.getElementById('playerExchangeSelect');
            select.innerHTML = '';
            const state = gameLogic.getGameState();
            state.squad.forEach(p => {
                const option = document.createElement('option');
                option.value = p.name;
                option.textContent = `${p.name} (OVR: ${p.overall}) - VAL: ${p.value.toLocaleString('es-ES')}â‚¬`;
                select.appendChild(option);
            });
        }
        window.populatePlayerExchangeSelect = populatePlayerExchangeSelect;

        window.submitLoanOffer = function() {
            const loanWageContribution = parseInt(document.getElementById('loanWageContribution').value);
            const result = gameLogic.offerToClub(loanWageContribution, [], true);
            alert(result.message);
            if (result.success) {
                window.endNegotiationUI(true);
            } else {
                if (result.message.includes('rechazado tu oferta de cesiÃ³n')) {
                    window.endNegotiationUI(false);
                }
            }
        };

        window.submitTransferOffer = function() {
            const offerAmount = parseInt(document.getElementById('offerAmount').value);
            const playerExchangeSelect = document.getElementById('playerExchangeSelect');
            const selectedPlayers = Array.from(playerExchangeSelect.selectedOptions).map(option => option.value);

            const result = gameLogic.offerToClub(offerAmount, selectedPlayers, false);
            alert(result.message);
            if (result.success) {
                window.endNegotiationUI(true);
            } else {
                if (result.message.includes('rechazado tu oferta')) {
                    window.endNegotiationUI(false);
                }
            }
        };

        window.endNegotiationUI = function(success) {
            gameLogic.endNegotiation(success);
            window.closeModal('negotiation');
            ui.refreshUI(gameLogic.getGameState());
        };

        // Entrenamiento
        let currentTrainingPlayerIndex = -1;

        window.setPlayerTrainingFocusUI = function(playerIndex, playerName) {
            currentTrainingPlayerIndex = playerIndex;
            const state = gameLogic.getGameState();
            const player = state.squad[playerIndex];

            if (!player) return;

            document.getElementById('trainingPlayerName').textContent = playerName;
            document.getElementById('trainingPlayerNameInfo').textContent = playerName;
            document.getElementById('trainingPlayerPosition').textContent = player.position;
            document.getElementById('trainingPlayerOverall').textContent = player.overall;
            document.getElementById('trainingPlayerPotential').textContent = player.potential;

            const attributesList = document.getElementById('trainingPlayerAttributes');
            attributesList.innerHTML = '';
            ATTRIBUTES.forEach(attr => {
                attributesList.innerHTML += `<li style="display: flex; flex-direction: column; align-items: center; border: 1px solid rgba(233, 69, 96, 0.3); padding: 5px; border-radius: 3px;"><strong>${attr}:</strong> ${player[attr] || 0}</li>`;
            });

            const attributeRadioButtons = document.getElementById('attributeRadioButtons');
            attributeRadioButtons.innerHTML = '';
            ATTRIBUTES.forEach(attr => {
                const checked = (state.trainingFocus.playerIndex === playerIndex && state.trainingFocus.attribute === attr) ? 'checked' : '';
                attributeRadioButtons.innerHTML += `
                    <div>
                        <input type="radio" id="attr_${attr}" name="trainingAttribute" value="${attr}" ${checked}>
                        <label for="attr_${attr}">${attr}</label>
                    </div>
                `;
            });

            if (!state.staff.entrenador) {
                document.getElementById('trainingStaffWarning').style.display = 'block';
            } else {
                document.getElementById('trainingStaffWarning').style.display = 'none';
            }

            if (player.position === 'POR' && !state.staff.entrenadorPorteros) {
                document.getElementById('trainingGkStaffWarning').style.display = 'block';
            } else {
                document.getElementById('trainingGkStaffWarning').style.display = 'none';
            }

            window.openModal('training');
        };

        window.submitTrainingFocus = function() {
            const selectedAttribute = document.querySelector('input[name="trainingAttribute"]:checked')?.value;
            if (!selectedAttribute) {
                alert('Por favor, selecciona un atributo para entrenar.');
                return;
            }

            const result = gameLogic.setTrainingFocus(currentTrainingPlayerIndex, selectedAttribute);
            alert(result.message);
            if (result.success) {
                window.closeModal('training');
            }
            ui.refreshUI(gameLogic.getGameState());
        };

        // Staff
        window.openHireStaffModal = function(role) {
            document.getElementById('staffRoleDisplayName').textContent = STAFF_ROLES[role].displayName;
            document.getElementById('staffRoleDisplayNameInfo').textContent = STAFF_ROLES[role].displayName;

            const candidates = gameLogic.generateStaffCandidates(role, true);
            const list = document.getElementById('staffCandidatesList');
            const state = gameLogic.getGameState();
            const existingStaff = state.staff[role];

            let indemnizationMessage = '';
            if (existingStaff) {
                const indemnization = existingStaff.salary * 52;
                indemnizationMessage = `<p class="alert alert-warning">Al contratar a un nuevo ${STAFF_ROLES[role].displayName}, se despedirÃ¡ a ${existingStaff.name} con una indemnizaciÃ³n de ${indemnization.toLocaleString('es-ES')}â‚¬ (salario de un aÃ±o).</p>`;
            }

            list.innerHTML = indemnizationMessage + candidates.map((c, idx) => `
                <div class="staff-candidate">
                    <div>
                        <strong>${c.name}</strong> (Nivel ${c.level})<br>
                        Salario: ${c.salary.toLocaleString('es-ES')}â‚¬/semana | ClÃ¡usula: ${c.clausula.toLocaleString('es-ES')}â‚¬
                    </div>
                    <button class="btn btn-sm" onclick="window.hireStaffConfirm('${encodeURIComponent(JSON.stringify(c))}')">Contratar</button>
                </div>
            `).join('');

            window.openModal('hireStaff');
        };

        window.hireStaffConfirm = function(encodedCandidateJson) {
            const candidate = JSON.parse(decodeURIComponent(encodedCandidateJson));
            const state = gameLogic.getGameState();
            const existingStaff = state.staff[candidate.role];
            let confirmationMessage = `Â¿EstÃ¡s seguro de que quieres contratar a ${candidate.name} (Nivel ${candidate.level}) por un salario de ${candidate.salary.toLocaleString('es-ES')}â‚¬/semana y una clÃ¡usula de ${candidate.clausula.toLocaleString('es-ES')}â‚¬?`;

            if (existingStaff) {
                const indemnization = existingStaff.salary * 52;
                confirmationMessage += `\n\nEsto implicarÃ¡ despedir a ${existingStaff.name} con una indemnizaciÃ³n de ${indemnization.toLocaleString('es-ES')}â‚¬ (salario de un aÃ±o).`;
            }

            if (confirm(confirmationMessage)) {
                const result = gameLogic.hireStaffFromCandidates(candidate);
                alert(result.message);
                if (result.success) {
                    window.closeModal('hireStaff');
                }
                ui.refreshUI(gameLogic.getGameState());
                window.updateStaffDisplay(gameLogic.getGameState());
            }
        };

        // TÃ¡cticas
        window.updateFormation = function() {
            const state = gameLogic.getGameState();
            const newFormation = document.getElementById('formationSelect').value;
            const updatedState = { ...state, formation: newFormation };
            gameLogic.updateGameState(updatedState);
            alert('FormaciÃ³n actualizada a ' + FORMATIONS[updatedState.formation].name);
            window.renderLineupPageUI();
        };

        window.updateMentality = function() {
            const state = gameLogic.getGameState();
            const newMentality = document.getElementById('mentalitySelect').value;
            const updatedState = { ...state, mentality: newMentality };
            gameLogic.updateGameState(updatedState);
            alert('Mentalidad tÃ¡ctica actualizada a ' + updatedState.mentality);
        };

        function updateTacticsDisplay(state) {
            const formationSelect = document.getElementById('formationSelect');
            const mentalitySelect = document.getElementById('mentalitySelect');
            if(formationSelect) formationSelect.value = state.formation;
            if(mentalitySelect) mentalitySelect.value = state.mentality;
        }
        window.updateTacticsDisplay = updateTacticsDisplay;

        // Instalaciones
        window.expandStadium = function() {
            const result = gameLogic.expandStadium();
            alert(result.message);
            ui.refreshUI(gameLogic.getGameState());
            window.updateFacilitiesDisplay(gameLogic.getGameState());
        };

        window.improveFacilities = function() {
            const result = gameLogic.improveFacilities();
            alert(result.message);
            ui.refreshUI(gameLogic.getGameState());
            window.updateFacilitiesDisplay(gameLogic.getGameState());
        };

        function updateFacilitiesDisplay(state) {
            const currentStadiumCapacity = document.getElementById('currentStadiumCapacity');
            const currentTrainingLevel = document.getElementById('currentTrainingLevel');
            const stadiumNameDisplay = document.getElementById('stadiumNameDisplay');
            const stadiumImageContainer = document.getElementById('stadiumImageContainer');

            if (currentStadiumCapacity) currentStadiumCapacity.textContent = state.stadiumCapacity.toLocaleString('es-ES');
            if (currentTrainingLevel) currentTrainingLevel.textContent = state.trainingLevel;
            if (stadiumNameDisplay) stadiumNameDisplay.textContent = state.stadiumName || 'Estadio Municipal';

            if (stadiumImageContainer && state.stadiumImage) {
                stadiumImageContainer.innerHTML = `
                    <img src="${state.stadiumImage}"
                         style="max-width: 100%; max-height: 300px; border: 2px solid #e94560; border-radius: 10px; display: block;">
                `;
            } else if (stadiumImageContainer) {
                stadiumImageContainer.innerHTML = '<p style="color: #999;">No hay imagen del estadio disponible</p>';
            }
        }
        window.updateFacilitiesDisplay = updateFacilitiesDisplay;

        // Staff Display
        function updateStaffDisplay(state) {
            Object.keys(STAFF_ROLES).forEach(role => {
                const staff = state.staff[role];
                const nameElem = document.getElementById(`staff${role.charAt(0).toUpperCase() + role.slice(1)}Name`);
                const levelElem = document.getElementById(`staff${role.charAt(0).toUpperCase() + role.slice(1)}Level`);
                const salaryElem = document.getElementById(`staff${role.charAt(0).toUpperCase() + role.slice(1)}Salary`);
                const clausulaElem = document.getElementById(`staff${role.charAt(0).toUpperCase() + role.slice(1)}Clausula`);
                const btnElem = document.getElementById(`btnHire${role.charAt(0).toUpperCase() + role.slice(1)}`);

                if (nameElem) nameElem.textContent = staff ? staff.name : 'No Contratado';
                if (levelElem) levelElem.textContent = staff ? staff.level : '-';
                if (salaryElem) salaryElem.textContent = staff ? staff.salary.toLocaleString('es-ES') + 'â‚¬' : '-';
                if (clausulaElem) clausulaElem.textContent = staff ? 'N/A' : '-';
                if (btnElem) {
                    btnElem.disabled = !!staff;
                    btnElem.textContent = staff ? 'Contratado' : 'Contratar';
                }
            });
        }
        window.updateStaffDisplay = updateStaffDisplay;

        // Precios
        window.setTicketPriceFromInput = function() {
            const input = document.getElementById('ticketPriceInput');
            const newPrice = input.value;
            const result = gameLogic.setTicketPrice(newPrice);
            if (result.success) {
                alert(result.message);
                ui.refreshUI(gameLogic.getGameState());
                window.updateFinanceDisplay(gameLogic.getGameState());
                window.updateCommercialDisplay(gameLogic.getGameState());
            } else {
                alert('Error: ' + result.message);
                input.value = gameLogic.getGameState().ticketPrice;
            }
        };

        window.setMerchandisingPriceFromInput = function() {
            const input = document.getElementById('merchandisingPriceInput');
            const newPrice = input.value;
            const result = gameLogic.setMerchandisingPrice(newPrice);
            if (result.success) {
                alert(result.message);
                ui.refreshUI(gameLogic.getGameState());
                window.updateFinanceDisplay(gameLogic.getGameState());
                window.updateCommercialDisplay(gameLogic.getGameState());
            } else {
                alert('Error: ' + result.message);
                input.value = gameLogic.getGameState().merchandisingPrice;
            }
        };

        window.updateTicketPriceDisplay = function(value) {
            document.getElementById('ticketPriceSliderValue').textContent = value;
        };

        window.setTicketPriceFromSlider = function(value) {
            const result = gameLogic.setTicketPrice(value);
            if (result.success) {
                ui.refreshUI(gameLogic.getGameState());
                window.updateFinanceDisplay(gameLogic.getGameState());
            } else {
                alert('Error: ' + result.message);
                document.getElementById('ticketPriceSlider').value = gameLogic.getGameState().ticketPrice;
                document.getElementById('ticketPriceSliderValue').textContent = gameLogic.getGameState().ticketPrice;
            }
        };

        window.updateMerchandisingPriceDisplay = function(value) {
            document.getElementById('merchandisingPriceSliderValue').textContent = value;
        };

        window.setMerchandisingPriceFromSlider = function(value) {
            const result = gameLogic.setMerchandisingPrice(value);
            if (result.success) {
                ui.refreshUI(gameLogic.getGameState());
                window.updateFinanceDisplay(gameLogic.getGameState());
            } else {
                alert('Error: ' + result.message);
                document.getElementById('merchandisingPriceSlider').value = gameLogic.getGameState().merchandisingPrice;
                document.getElementById('merchandisingPriceSliderValue').textContent = gameLogic.getGameState().merchandisingPrice;
            }
        };

       function updateFinanceDisplay(state) {
    // === DATOS PRINCIPALES ===
    document.getElementById('financeWeeklyIncome').textContent = state.weeklyIncome.toLocaleString('es-ES') + 'â‚¬';
    document.getElementById('financeWeeklyExpenses').textContent = state.weeklyExpenses.toLocaleString('es-ES') + 'â‚¬';
    document.getElementById('financeBalance').textContent = state.balance.toLocaleString('es-ES') + 'â‚¬';

    // === ESTADIO ===
    document.getElementById('financeStadiumCapacity').textContent = state.stadiumCapacity.toLocaleString('es-ES');

    // Calcular asistencia esperada
    let attendance = Math.floor(state.stadiumCapacity * (0.5 + (state.popularity / 200) - (state.ticketPrice / 100)));
    attendance = Math.max(0, Math.min(state.stadiumCapacity, attendance));
    document.getElementById('financeExpectedAttendance').textContent = attendance.toLocaleString('es-ES');

    // Precio de entrada
    const ticketPriceInput = document.getElementById('ticketPriceInput');
    if (ticketPriceInput) ticketPriceInput.value = state.ticketPrice;
    
    // âœ… NUEVO: Ingresos por taquilla
    const ticketIncome = Math.floor(state.ticketPrice * attendance);
    const ticketIncomeElement = document.getElementById('financeTicketIncome');
    if (ticketIncomeElement) {
        ticketIncomeElement.textContent = ticketIncome.toLocaleString('es-ES') + 'â‚¬';
    }

    // === POPULARIDAD Y MERCHANDISING ===
    document.getElementById('financePopularity').textContent = state.popularity + '%';
    document.getElementById('financeFanbase').textContent = state.fanbase.toLocaleString('es-ES');
    document.getElementById('financeMerchandisingItemsSold').textContent = state.merchandisingItemsSold.toLocaleString('es-ES');

    const merchandisingPriceInput = document.getElementById('merchandisingPriceInput');
    if (merchandisingPriceInput) merchandisingPriceInput.value = state.merchandisingPrice;

    document.getElementById('financeMerchandisingRevenue').textContent = state.merchandisingRevenue.toLocaleString('es-ES') + 'â‚¬';

    // ========================================
    // âœ… NUEVAS SECCIONES: TRANSACCIONES DE JUGADORES
    // ========================================
    
    // === VENTAS DE JUGADORES ===
    const playerSales = state.playerSalesIncome || 0;
    const playerSalesElement = document.getElementById('financePlayerSales');
    if (playerSalesElement) {
        playerSalesElement.textContent = playerSales.toLocaleString('es-ES') + 'â‚¬';
    }

    // === GASTOS: SALARIOS ===
    const playerSalaries = state.squad.reduce((sum, p) => sum + (p.salary || 0), 0);
    const playerSalariesElement = document.getElementById('financePlayerSalaries');
    if (playerSalariesElement) {
        playerSalariesElement.textContent = playerSalaries.toLocaleString('es-ES') + 'â‚¬/sem';
    }

    const staffSalaries = Object.values(state.staff).reduce((sum, s) => sum + (s?.salary || 0), 0);
    const staffSalariesElement = document.getElementById('financeStaffSalaries');
    if (staffSalariesElement) {
        staffSalariesElement.textContent = staffSalaries.toLocaleString('es-ES') + 'â‚¬/sem';
    }

    // === COMPRAS DE JUGADORES ===
    const playerPurchases = state.playerPurchases || 0;
    const playerPurchasesElement = document.getElementById('financePlayerPurchases');
    if (playerPurchasesElement) {
        playerPurchasesElement.textContent = playerPurchases.toLocaleString('es-ES') + 'â‚¬';
    }

    // === INDEMNIZACIONES ===
    const compensations = state.playerCompensations || 0;
    const compensationsElement = document.getElementById('financeCompensations');
    if (compensationsElement) {
        compensationsElement.textContent = compensations.toLocaleString('es-ES') + 'â‚¬';
    }

    // === TOTAL GASTOS SEMANALES ===
    const totalExpenses = state.weeklyExpenses;
    const totalExpensesElement = document.getElementById('financeTotalExpenses');
    if (totalExpensesElement) {
        totalExpensesElement.textContent = totalExpenses.toLocaleString('es-ES') + 'â‚¬';
    }

    // === BALANCE SEMANAL ===
    const weeklyBalance = state.weeklyIncome - state.weeklyExpenses;
    const weeklyBalanceElement = document.getElementById('financeWeeklyBalance');
    if (weeklyBalanceElement) {
        weeklyBalanceElement.textContent = (weeklyBalance >= 0 ? '+' : '') + weeklyBalance.toLocaleString('es-ES') + 'â‚¬';
        weeklyBalanceElement.style.color = weeklyBalance >= 0 ? '#4CAF50' : '#ff3333';
    }
}
        window.updateFinanceDisplay = updateFinanceDisplay;

        function updateCommercialDisplay(state) {
            document.getElementById('commercialPopularity').textContent = state.popularity + '%';
            document.getElementById('commercialFanbase').textContent = state.fanbase.toLocaleString('es-ES');
            document.getElementById('commercialItemsSold').textContent = state.merchandisingItemsSold.toLocaleString('es-ES');
            document.getElementById('commercialMerchRevenue').textContent = state.merchandisingRevenue.toLocaleString('es-ES') + 'â‚¬';

            const ticketPriceSlider = document.getElementById('ticketPriceSlider');
            const merchandisingPriceSlider = document.getElementById('merchandisingPriceSlider');

            if (ticketPriceSlider) {
                ticketPriceSlider.value = state.ticketPrice;
                document.getElementById('currentTicketPrice').textContent = state.ticketPrice;
                document.getElementById('ticketPriceSliderValue').textContent = state.ticketPrice;
            }
            if (merchandisingPriceSlider) {
                merchandisingPriceSlider.value = state.merchandisingPrice;
                document.getElementById('currentMerchandisingPrice').textContent = state.merchandisingPrice;
                document.getElementById('merchandisingPriceSliderValue').textContent = state.merchandisingPrice;
            }
        }
        window.updateCommercialDisplay = updateCommercialDisplay;

        // AlineaciÃ³n
        window.renderLineupPageUI = function() {
            const state = gameLogic.getGameState();
            const currentFormation = FORMATIONS[state.formation];
            let lineup = gameLogic.getLineup();
            let reserves = gameLogic.getReservePlayers();

            const pitchContainer = document.getElementById('pitchContainer');
            const reservesList = document.getElementById('reservesList');

            pitchContainer.innerHTML = '';
            reservesList.innerHTML = '';

            const slotWidth = 18;
            const slotHeight = 10;

            currentFormation.layout.forEach((posData, index) => {
                const slot = document.createElement('div');
                slot.classList.add('pitch-position-placeholder');
                slot.id = `pitch-slot-${index}`;

              /*  const leftOffset = posData.x * (100 / 5) + ( (100 / 5) - slotWidth ) / 2;
                const topOffset = posData.y * (100 / 8) + ( (100 / 8) - slotHeight ) / 2; */

                const leftOffset = posData.y * (100 / 8) + ((100 / 8) - slotWidth) / 2;
                const topOffset  = posData.x * (100 / 5) + ((100 / 5) - slotHeight) / 2;


                slot.style.left = `${leftOffset}%`;
                slot.style.top = `${topOffset}%`;
                slot.style.width = `${slotWidth}%`;
                slot.style.height = `${slotHeight}%`;

                slot.textContent = posData.pos;
                slot.ondragover = window.allowDrop;
                slot.ondragleave = window.dragleave;
                slot.ondrop = (ev) => window.drop(ev, `pitch-slot-${index}`);

                const playerInSlot = lineup[index];
                if (playerInSlot) {
                    const playerDiv = document.createElement('div');
                    playerDiv.classList.add('pitch-player');
                    var _pSq = window.gameLogic && window.gameLogic.getGameState().squad && window.gameLogic.getGameState().squad.find(function(p){ return p.name === playerInSlot.name; });
                    if (_pSq) { playerInSlot.isSuspended = _pSq.isSuspended||false; playerInSlot.suspensionWeeks = _pSq.suspensionWeeks||0; }
                    if (playerInSlot.isInjured) playerDiv.classList.add('injured');
                    if (playerInSlot.isSuspended) playerDiv.classList.add('suspended');
                    playerDiv.draggable = true;
                    playerDiv.ondragstart = (ev) => window.drag(ev, encodeURIComponent(JSON.stringify(playerInSlot)));
                    playerDiv.innerHTML = `<span>${playerInSlot.name}</span><span>(${playerInSlot.position}, ${playerInSlot.overall})</span>`;
                    playerDiv.dataset.playername = playerInSlot.name;
                    // âœ… AquÃ­ aÃ±adimos el onclick para abrir modal
                    playerDiv.onclick = () => openPlayerModal(playerInSlot);
                    slot.appendChild(playerDiv);
                }
                pitchContainer.appendChild(slot);
            });

            reserves.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.classList.add('draggable-player');
                var _rSq = window.gameLogic && window.gameLogic.getGameState().squad && window.gameLogic.getGameState().squad.find(function(p){ return p.name === player.name; });
                if (_rSq) { player.isSuspended = _rSq.isSuspended||false; player.suspensionWeeks = _rSq.suspensionWeeks||0; }
                if (player.isInjured) playerDiv.classList.add('injured');
                if (player.isSuspended) playerDiv.classList.add('suspended');
                playerDiv.draggable = true;
                playerDiv.ondragstart = (ev) => window.drag(ev, encodeURIComponent(JSON.stringify(player)));
                playerDiv.textContent = `${player.name} (${player.overall}) - ${player.position}`;
                playerDiv.dataset.playername = player.name;
                // âœ… AquÃ­ aÃ±adimos el onclick para abrir modal
                playerDiv.onclick = () => openPlayerModal(player);
                reservesList.appendChild(playerDiv);
            });

            reservesList.ondragover = window.allowDrop;
            reservesList.ondragleave = window.dragleave;
            reservesList.ondrop = (ev) => window.drop(ev, 'reservesList');

            const lineupMessageElem = document.getElementById('lineupMessage');
            if (lineupMessageElem) {
                const validation = gameLogic.validateLineup(lineup);
                if (!validation.success) {
                    lineupMessageElem.className = 'alert alert-warning';
                    lineupMessageElem.innerHTML = `âš ï¸ Advertencia: ${validation.message}`;
                } else {
                    lineupMessageElem.className = 'alert alert-info';
                    lineupMessageElem.innerHTML = `AlineaciÃ³n actual: ${FORMATIONS[state.formation].name}. Arrastra y suelta jugadores para configurar tu alineaciÃ³n.`;
                }
            }
        };

        
        

        window.saveLineup = function() {
            const state = gameLogic.getGameState();
            const currentFormation = FORMATIONS[state.formation];
            const newLayout = Array(11).fill(null);

            currentFormation.layout.forEach((posData, index) => {
                const slot = document.getElementById(`pitch-slot-${index}`);
                const playerDiv = slot?.querySelector('.pitch-player');
                if (playerDiv) {
                    const playerName = playerDiv.dataset.playername;
                    const fullPlayer = state.squad.find(p => p.name === playerName);
                    if (fullPlayer) {
                        newLayout[index] = fullPlayer;
                    }
                }
            });

            const validationResult = gameLogic.validateLineup(newLayout);
            if (!validationResult.success) {
                alert(`Error al guardar la alineaciÃ³n: ${validationResult.message}`);
                gameLogic.addNews(`[Segundo Entrenador - ALINEACIÃ“N] Error al guardar: ${validationResult.message}`, 'error');
                window.renderLineupPageUI();
                return;
            }

            const result = gameLogic.setLineup(newLayout);
            if (result.success) {
                gameLogic.addNews('Â¡AlineaciÃ³n guardada con Ã©xito!', 'success');
                alert(result.message);
                ui.refreshUI(gameLogic.getGameState());
                window.renderLineupPageUI();
            } else {
                gameLogic.addNews(`[Segundo Entrenador - ALINEACIÃ“N] Error al guardar la alineaciÃ³n: ${result.message}`, 'error');
                alert(`Error al guardar la alineaciÃ³n: ${result.message}`);
            }
        };

        // Guardar/Cargar
        window.saveCurrentGame = async function() {
            if (!window.currentUserId) {
                alert('âš ï¸ Debes iniciar sesiÃ³n para guardar partidas en la nube.');
                return;
            }

            const gameName = prompt('Introduce un nombre para tu partida guardada:', `Partida ${new Date().toLocaleDateString()}`);
            if (!gameName) return;

            const gameId = 'game_' + Date.now();
            const currentGameState = gameLogic.getGameState();

            try {
                const result = await window.saveGameToCloud(window.currentUserId, gameId, gameName, currentGameState);
                if (result.success) {
                    alert('âœ… Partida guardada en la nube correctamente.');
                } else {
                    alert('âŒ Error al guardar la partida en la nube: ' + (result.error || 'Error desconocido'));
                    console.error('Error al guardar la partida en la nube:', result.error);
                }
            } catch (error) {
                console.error('Error inesperado al guardar la partida:', error);
                alert('âŒ Error inesperado al guardar la partida: ' + error.message);
            }
        };

        // Modales
        window.openModal = function(type) {
            document.getElementById(type + 'Modal').classList.add('active');
        };

       

        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸŽ® Inicializando PC FÃºtbol Manager...');
            
            const marketPositionSelect = document.getElementById('marketPosition');
            POSITIONS.forEach(pos => {
                const option = document.createElement('option');
                option.value = pos;
                option.textContent = pos;
                marketPositionSelect.appendChild(option);
            });

            const formationSelect = document.getElementById('formationSelect');
            Object.keys(FORMATIONS).forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = FORMATIONS[key].name;
                formationSelect.appendChild(option);
            });

           // NO cargar automÃ¡ticamente - esperar a que el usuario elija
console.log('â¸ï¸ Esperando selecciÃ³n del usuario (Nueva/Cargar desde nube)');
// No hacer nada aquÃ­ - el modal de login se encargarÃ¡
        });


        // ============================================
// SISTEMA DE RENOVACIONES DE CONTRATOS
// ============================================

// Variable global para el jugador en renovaciÃ³n
let currentRenewalPlayerIndex = -1;

// Abrir modal de renovaciÃ³n
window.openRenewalModal = function(playerIndex) {
    const state = window.gameLogic.getGameState();
    const player = state.squad[playerIndex];
    
    if (!player) {
        alert('Error: Jugador no encontrado');
        return;
    }
    
    if (player.contractType !== 'owned') {
        alert('No puedes renovar a jugadores cedidos');
        return;
    }
    
    currentRenewalPlayerIndex = playerIndex;
    
    // Rellenar informaciÃ³n del jugador
    document.getElementById('renewalPlayerName').textContent = player.name;
    document.getElementById('renewalPlayerPosition').textContent = player.position;
    document.getElementById('renewalPlayerAge').textContent = player.age;
    document.getElementById('renewalPlayerOverall').textContent = player.overall;
    
    // Contrato actual
    document.getElementById('renewalCurrentYears').textContent = player.contractYears + ' aÃ±os';
    document.getElementById('renewalCurrentSalary').textContent = player.salary.toLocaleString('es-ES') + 'â‚¬/sem';
    document.getElementById('renewalCurrentClause').textContent = (player.releaseClause || 0).toLocaleString('es-ES') + 'â‚¬';
    
    // Valores por defecto para nueva oferta
    document.getElementById('renewalNewYears').value = 3;
    document.getElementById('renewalNewSalary').value = Math.round(player.salary * 1.1);
    document.getElementById('renewalNewClause').value = player.releaseClause || (player.value * 3);
    
    // Resetear checkboxes
    document.getElementById('renewalBonus').checked = false;
    document.getElementById('renewalCar').checked = false;
    document.getElementById('renewalHouse').checked = false;
    
    // Abrir modal
    const modal = document.getElementById('renewalModal');
    if (modal) {
        modal.classList.add('active');
    }
    
    // Calcular probabilidad inicial
    updateRenewalProbability();
};

// Actualizar probabilidad de aceptaciÃ³n
window.updateRenewalProbability = function() {
    const state = window.gameLogic.getGameState();
    const player = state.squad[currentRenewalPlayerIndex];
    
    if (!player) return;
    
    const newSalary = parseInt(document.getElementById('renewalNewSalary').value) || 0;
    const newYears = parseInt(document.getElementById('renewalNewYears').value) || 0;
    const bonus = document.getElementById('renewalBonus').checked;
    const car = document.getElementById('renewalCar').checked;
    const house = document.getElementById('renewalHouse').checked;
    
    let probability = 50;
    
    const salaryIncrease = (newSalary - player.salary) / player.salary;
    if (salaryIncrease >= 0.2) probability += 30;
    else if (salaryIncrease >= 0.1) probability += 20;
    else if (salaryIncrease >= 0) probability += 10;
    else if (salaryIncrease >= -0.1) probability -= 20;
    else probability -= 40;
    
    if (newYears >= 4) probability += 15;
    else if (newYears >= 3) probability += 10;
    else if (newYears >= 2) probability += 5;
    
    if (bonus) probability += 10;
    if (car) probability += 5;
    if (house) probability += 5;
    
    if (player.age > 30 && newYears >= 3) probability += 10;
    if (player.contractYears <= 1) probability += 15;
    
    probability = Math.max(0, Math.min(100, probability));
    
    const probabilityElement = document.getElementById('renewalProbability');
    if (probabilityElement) {
        probabilityElement.textContent = Math.round(probability) + '%';
        
        if (probability >= 70) {
            probabilityElement.style.color = '#4CAF50';
        } else if (probability >= 40) {
            probabilityElement.style.color = '#FF9800';
        } else {
            probabilityElement.style.color = '#ff3333';
        }
    }
    
    const warningElement = document.getElementById('renewalSalaryWarning');
    if (warningElement) {
        if (newSalary < player.salary * 0.9) {
            warningElement.style.display = 'block';
        } else {
            warningElement.style.display = 'none';
        }
    }
};

// Enviar oferta de renovaciÃ³n
window.submitRenewalOffer = function() {
    const state = window.gameLogic.getGameState();
    const player = state.squad[currentRenewalPlayerIndex];
    
    if (!player) {
        alert('Error: Jugador no encontrado');
        return;
    }
    
    const newSalary = parseInt(document.getElementById('renewalNewSalary').value) || 0;
    const newYears = parseInt(document.getElementById('renewalNewYears').value) || 0;
    const newClause = parseInt(document.getElementById('renewalNewClause').value) || 0;
    const bonus = document.getElementById('renewalBonus').checked;
    const car = document.getElementById('renewalCar').checked;
    const house = document.getElementById('renewalHouse').checked;
    
    if (newSalary <= 0) {
        alert('El salario debe ser mayor que 0');
        return;
    }
    
    if (newYears < 1 || newYears > 5) {
        alert('La duraciÃ³n debe ser entre 1 y 5 aÃ±os');
        return;
    }
    
    if (newClause < 0) {
        alert('La clÃ¡usula no puede ser negativa');
        return;
    }
    
    // Calcular probabilidad
    let probability = 50;
    
    const salaryIncrease = (newSalary - player.salary) / player.salary;
    if (salaryIncrease >= 0.2) probability += 30;
    else if (salaryIncrease >= 0.1) probability += 20;
    else if (salaryIncrease >= 0) probability += 10;
    else if (salaryIncrease >= -0.1) probability -= 20;
    else probability -= 40;
    
    if (newYears >= 4) probability += 15;
    else if (newYears >= 3) probability += 10;
    else if (newYears >= 2) probability += 5;
    
    if (bonus) probability += 10;
    if (car) probability += 5;
    if (house) probability += 5;
    
    if (player.age > 30 && newYears >= 3) probability += 10;
    if (player.contractYears <= 1) probability += 15;
    
    probability = Math.max(5, Math.min(95, probability));
    
    const accepted = Math.random() * 100 < probability;
    
    if (accepted) {
        // âœ… ACTUALIZAR CONTRATO
        player.salary = newSalary;
        player.contractYears = player.contractYears + newYears;  // âœ… SUMAR aÃ±os
        player.releaseClause = newClause;
        
        let renewalCost = 0;
        if (bonus) renewalCost += newSalary * 10;
        if (car) renewalCost += 50000;
        if (house) renewalCost += 200000;
        
        state.balance -= renewalCost;

                // âœ… GUARDAR Y REFRESCAR
        window.gameLogic.updateGameState(state);
        window.gameLogic.saveToLocalStorage();
        
        window.gameLogic.addNews(
            `âœ… Â¡${player.name} ha aceptado la renovaciÃ³n! Nuevo contrato: ${newYears} aÃ±os, ${newSalary.toLocaleString('es-ES')}â‚¬/sem`,
            'success'
        );
        
        if (renewalCost > 0) {
            window.gameLogic.addNews(
                `ðŸ’° Coste de renovaciÃ³n: ${renewalCost.toLocaleString('es-ES')}â‚¬`,
                'info'
            );
        }
                
        window.closeModal('renewal');
        window.ui.refreshUI(state);
        
        // Refrescar pÃ¡ginas si estÃ¡n abiertas
        if (document.getElementById('negotiations').classList.contains('active')) {
            window.ui.renderNegotiationsList(state);
        }
        
        if (document.getElementById('squad').classList.contains('active')) {
            window.ui.renderSquadList(state.squad, state.team);
        }
        
        alert(`âœ… Â¡${player.name} ha aceptado la renovaciÃ³n!\n\nNuevo contrato: ${newYears} aÃ±os\nSalario: ${newSalary.toLocaleString('es-ES')}â‚¬/sem\nCoste total: ${renewalCost.toLocaleString('es-ES')}â‚¬`);
        
    } else {
        window.gameLogic.addNews(
            `âŒ ${player.name} ha rechazado tu oferta de renovaciÃ³n`,
            'warning'
        );
        
        alert(`âŒ ${player.name} ha rechazado tu oferta.\n\nProbabilidad de aceptaciÃ³n: ${Math.round(probability)}%\n\nPuedes intentarlo de nuevo con una mejor oferta.`);
    }
    
    currentRenewalPlayerIndex = -1;
};

// Event listeners para actualizar probabilidad en tiempo real
document.addEventListener('DOMContentLoaded', () => {
    const renewalSalary = document.getElementById('renewalNewSalary');
    const renewalYears = document.getElementById('renewalNewYears');
    const renewalBonus = document.getElementById('renewalBonus');
    const renewalCar = document.getElementById('renewalCar');
    const renewalHouse = document.getElementById('renewalHouse');
    
    if (renewalSalary) renewalSalary.addEventListener('input', window.updateRenewalProbability);
    if (renewalYears) renewalYears.addEventListener('change', window.updateRenewalProbability);
    if (renewalBonus) renewalBonus.addEventListener('change', window.updateRenewalProbability);
    if (renewalCar) renewalCar.addEventListener('change', window.updateRenewalProbability);
    if (renewalHouse) renewalHouse.addEventListener('change', window.updateRenewalProbability);
});



function openPlayerModal(player) {
    // Foto (puedes reemplazar por una URL real si tienes fotos de jugadores)
    document.getElementById('modalPlayerPhoto').src = player.photo || "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='150'%3E%3Crect fill='%23ddd' width='120' height='150'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-family='Arial' font-size='14'%3EFoto%3C/text%3E%3C/svg%3E";

    document.getElementById('modalPlayerName').innerText = player.name || 'Desconocido';
    document.getElementById('modalPlayerPosition').innerText = `PosiciÃ³n: ${player.position || '-'}`;
    document.getElementById('modalPlayerOverall').innerText = `OVR: ${player.overall || '-'}`;

    document.getElementById('modalPlayerPersonal').innerHTML = `
        Edad: ${player.age || '-'}<br>
        Nacionalidad: ${player.nationality || '-'}<br>
        Pie dominante: ${player.foot || '-'}
    `;

    document.getElementById('modalPlayerAttributes').innerHTML = `
        EN: ${player.EN || 0} | VE: ${player.VE || 0} | RE: ${player.RE || 0} | AG: ${player.AG || 0}<br>
        CA: ${player.CA || 0} | EF: ${player.EF || 0} | MO: ${player.MO || 0} | AT: ${player.AT || 0} | DF: ${player.DF || 0}
    `;

    document.getElementById('modalPlayerContract').innerHTML = `
        Tipo: ${player.contractType || '-'}<br>
        AÃ±os: ${player.contractYears || 0}<br>
        Release Clause: ${player.releaseClause || 0}<br>
        Salario: ${player.salary || 0}<br>
        Club: ${player.club || '-'}
    `;

    document.getElementById('modalPlayerStatus').innerHTML = `
        Lesionado: ${player.isInjured ? 'SÃ­' : 'No'}<br>
        Semanas fuera: ${player.weeksOut || 0}<br>
        Suspendido: ${player.isSuspended ? 'SÃ­' : 'No'}<br>
        Tarjetas amarillas: ${player.yellowCards || 0}<br>
        Tarjeta roja: ${player.redCards || 0}
    `;

    document.getElementById('modalPlayerStats').innerHTML = `
        Partidos: ${player.matches || 0}<br>
        Form: ${player.form || 0}<br>
        Minutos: ${player.minutesPlayed || 0}<br>
        Goles: ${player.goals || 0}<br>
        Asistencias: ${player.assists || 0}<br>
        Potential: ${player.potential || 0}
    `;

    document.getElementById('modalPlayerHistory').innerHTML = `
        ${player.history && player.history.length ? player.history.join('<br>') : 'Sin historial'}
    `;

    document.getElementById('playerModal').style.display = 'block';
}


        
// Cerrar modal
window.closePlayerModal = function() {
    document.getElementById('playerModal').style.display = 'none';
}

// Cerrar al hacer clic fuera del contenido
window.onclick = function(event) {
    const modal = document.getElementById('playerModal');
    if (event.target == modal) {
        closePlayerModal();
    }
};

        
     // final modal con datos del jugador -------------------------------------------------- 
        
        // Exponer globalmente
        window.gameLogic = gameLogic;
        window.ui = ui;
        window.TEAMS_DATA = TEAMS_DATA;
        window.ATTRIBUTES = ATTRIBUTES;
        window.POSITIONS = POSITIONS;
        window.FORMATIONS = FORMATIONS;
        console.log('âœ“ MÃ³dulos cargados y exportados');
    </script>

    <!-- Injectors -->
    <script src="./injector-login-ui.js"></script>
    <script src="./injector-cloud-load.js"></script>
    <script src="injector-login-game-selection.js"></script>
    <script src="./injector-budget.js"></script>
    <script src="./injector-player-arrows.js"></script>
    <script src="./injector-admin-complete.js"></script>
    <script src="./injector-expose-functions.js"></script>
    <script src="./injector-match-summary.js"></script>
  <!-- âœ… AÃ‘ADIR ESTA LÃNEA AQUÃ -->
    <script type="module" src="./injector-cards-injuries.js"></script>
  
    
  

<!-- âœ… AÃ‘ADIR ESTE MODAL AL FINAL DE index.html (antes del </body>) -->

<!-- MODAL: Ofertas Recibidas -->
<div id="offersModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <span class="modal-close" onclick="window.closeModal('offersModal')">&times;</span>
        <div id="offersList">
            <!-- AquÃ­ se renderizan las ofertas -->
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn" onclick="window.closeModal('offersModal')">Cerrar</button>
        </div>
    </div>
</div>

<script>
// Limpiar localStorage de partidas al cargar la pÃ¡gina
(function() {
    const gameKeys = Object.keys(localStorage).filter(k => 
        k.includes('pcfutbol') || k.includes('game') || k === 'pcfutbol-save'
    );
    
    if (gameKeys.length > 0) {
        console.log('ðŸ—‘ï¸ Limpiando localStorage:', gameKeys);
        gameKeys.forEach(k => localStorage.removeItem(k));
    }
})();
</script>
    
</body>
</html>
