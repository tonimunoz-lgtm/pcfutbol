<!DOCTYPE html>  
<html lang="es">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>PC F√∫tbol Manager 2025/26</title>  
    <style>  
        * { margin: 0; padding: 0; box-sizing: border-box; }  
  
        body {  
            font-family: Arial, sans-serif;  
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);  
            color: #fff;  
            min-height: 100vh;  
        }  
  
        .header {  
            background: linear-gradient(90deg, #0f3460 0%, #1a1a2e 100%);  
            border-bottom: 3px solid #e94560;  
            padding: 10px 20px;  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
            position: sticky;  
            top: 0;  
            z-index: 100;  
        }  
  
        .header-title {  
            font-size: 1.8em;  
            font-weight: bold;  
            color: #e94560;  
            letter-spacing: 2px;  
        }  
  
        .header-info {  
            display: flex;  
            gap: 20px;  
            align-items: center;  
            font-size: 0.9em;  
        }  
  
        .info-box {  
            background: rgba(233, 69, 96, 0.1);  
            border: 1px solid #e94560;  
            padding: 8px 15px;  
            border-radius: 3px;  
        }  
  
        .container {  
            display: flex;  
            max-width: 1600px;  
            margin: 0 auto;  
            min-height: calc(100vh - 60px);  
        }  
  
        .sidebar {  
            width: 200px;  
            background: linear-gradient(180deg, #0f3460 0%, #162a45 100%);  
            border-right: 2px solid #e94560;  
            padding: 15px 0;  
            overflow-y: auto;  
        }  
  
        .menu-section {  
            padding: 10px 0;  
            border-bottom: 1px solid rgba(233, 69, 96, 0.3);  
        }  
  
        .menu-title {  
            padding: 8px 15px;  
            color: #e94560;  
            font-size: 0.85em;  
            font-weight: bold;  
            text-transform: uppercase;  
        }  
  
        .menu-item {  
            padding: 10px 15px;  
            color: #fff;  
            cursor: pointer;  
            background: transparent;  
            border: none;  
            width: 100%;  
            text-align: left;  
            font-size: 0.9em;  
            transition: all 0.2s;  
        }  
  
        .menu-item:hover, .menu-item.active {  
            background: rgba(233, 69, 96, 0.4);  
            padding-left: 25px;  
        }  
  
        .menu-item.active {  
            background: #e94560;  
            font-weight: bold;  
        }  
  
        .main {  
            flex: 1;  
            padding: 20px;  
            overflow-y: auto;  
        }  
  
        .page { display: none; }  
        .page.active { display: block; animation: fadeIn 0.3s ease; }  
  
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }  
  
        h1 {  
            color: #e94560;  
            font-size: 1.8em;  
            margin-bottom: 20px;  
            border-bottom: 2px solid #e94560;  
            padding-bottom: 10px;  
        }  
  
        h2 {  
            color: #e94560;  
            font-size: 1.3em;  
            margin: 20px 0 10px 0;  
        }  
  
        .data-grid {  
            display: grid;  
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));  
            gap: 15px;  
            margin: 15px 0;  
        }  
  
        .data-box {  
            background: rgba(233, 69, 96, 0.1);  
            border: 1px solid #e94560;  
            padding: 15px;  
            border-radius: 3px;  
            text-align: center;  
        }  
  
        .data-label { color: #999; font-size: 0.8em; margin-bottom: 8px; }  
        .data-value { font-size: 1.8em; font-weight: bold; color: #00ff00; }  
        .data-value.negative { color: #ff3333; }  
  
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: rgba(0,0,0,0.3); }  
        th { padding: 12px; text-align: left; color: #e94560; background: rgba(233, 69, 96, 0.2); font-weight: bold; border: 1px solid rgba(233, 69, 96, 0.3); }  
        td { padding: 10px; border: 1px solid rgba(233, 69, 96, 0.15); }  
        tr:hover { background: rgba(233, 69, 96, 0.1); }  
  
        .btn {  
            background: linear-gradient(180deg, #e94560 0%, #c73446 100%);  
            color: white;  
            padding: 10px 20px;  
            border: none;  
            border-radius: 3px;  
            cursor: pointer;  
            font-weight: bold;  
            transition: all 0.2s;  
            margin: 5px 5px 5px 0;  
        }  
  
        .btn:hover { background: linear-gradient(180deg, #ff5577 0%, #e94560 100%); transform: translateY(-1px); }  
        .btn-sm { padding: 6px 12px; font-size: 0.85em; }  
  
        .modal {  
            display: none;  
            position: fixed;  
            z-index: 1000;  
            left: 0;  
            top: 0;  
            width: 100%;  
            height: 100%;  
            background: rgba(0,0,0,0.8);  
            align-items: center;  
            justify-content: center;  
        }  
  
        .modal.active { display: flex; }  
  
        .modal-content {  
            background: linear-gradient(180deg, #0f3460 0%, #1a1a2e 100%);  
            border: 2px solid #e94560;  
            padding: 30px;  
            border-radius: 5px;  
            max-width: 700px;  
            width: 90%;  
            max-height: 80vh;  
            overflow-y: auto;  
        }  
  
        .modal-close { float: right; color: #e94560; font-size: 2em; cursor: pointer; }  
  
        .player-card {  
            background: rgba(233, 69, 96, 0.08);  
            border: 1px solid #e94560;  
            padding: 12px;  
            margin: 8px 0;  
            border-radius: 3px;  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
        }  
  
        .alert {  
            padding: 12px;  
            margin: 10px 0;  
            border-radius: 3px;  
            border: 1px solid;  
        }  
  
        .alert-info { background: rgba(233, 69, 96, 0.1); border-color: #e94560; color: #e94560; }  
        .alert-success { background: rgba(0, 255, 0, 0.1); border-color: #00ff00; color: #00ff00; }  
        .alert-warning { background: rgba(255, 165, 0, 0.1); border-color: orange; color: orange; }  
  
        input, select {  
            width: 100%;  
            padding: 10px;  
            background: rgba(0,0,0,0.3);  
            border: 1px solid #e94560;  
            color: #fff;  
            border-radius: 3px;  
            margin-bottom: 10px;  
        }  
  
        @media (max-width: 768px) {  
            .container { flex-direction: column; }  
            .sidebar { width: 100%; border-right: none; border-bottom: 2px solid #e94560; }  
        }  
    </style>  
</head>  
<body>  
    <div class="header">  
        <div class="header-title">‚öΩ PC F√öTBOL MANAGER 25/26</div>  
        <div class="header-info">  
            <div class="info-box">Equipo: <span id="teamName">-</span></div>  
            <div class="info-box">Jornada: <span id="weekNo">1</span></div>  
            <div class="info-box">Dinero: <span id="balanceDisplay">0‚Ç¨</span></div>  
            <button class="btn btn-sm" onclick="openModal('gameMode')">Nuevo Juego</button>  
        </div>  
    </div>  
  
    <div class="container">  
        <div class="sidebar">  
            <div class="menu-section">  
                <div class="menu-title">üìä INFORMACI√ìN</div>  
                <button class="menu-item active" onclick="switchPage('dashboard', this)">Dashboard</button>  
                <button class="menu-item" onclick="switchPage('standings', this)">Clasificaci√≥n</button>  
            </div>  
  
            <div class="menu-section">  
                <div class="menu-title">üë• PLANTILLA</div>  
                <button class="menu-item" onclick="switchPage('squad', this)">Plantilla</button>  
                <button class="menu-item" onclick="switchPage('transfers', this)">Mercado</button>  
                <button class="menu-item" onclick="switchPage('academy', this)">Cantera</button>  
            </div>  
  
            <div class="menu-section">  
                <div class="menu-title">üéØ PARTIDO</div>  
                <button class="menu-item" onclick="switchPage('tactics', this)">T√°cticas</button>  
                <button class="menu-item" onclick="switchPage('match', this)">Pr√≥ximo</button>  
            </div>  
  
            <div class="menu-section">  
                <div class="menu-title">üíº GESTI√ìN</div>  
                <button class="menu-item" onclick="switchPage('finance', this)">Finanzas</button>  
                <button class="menu-item" onclick="switchPage('facilities', this)">Instalaciones</button>  
                <button class="menu-item" onclick="switchPage('commercial', this)">Comercial</button> <!-- Nueva secci√≥n -->  
                <button class="menu-item" onclick="switchPage('staff', this)">Staff</button>  
            </div>  
  
            <div class="menu-section">  
                <div class="menu-title">‚öôÔ∏è SISTEMA</div>  
                <button class="menu-item" onclick="switchPage('settings', this)">Opciones</button>  
            </div>  
        </div>  
  
        <div class="main">  
            <!-- DASHBOARD -->  
            <div id="dashboard" class="page active">  
                <h1>üìä Dashboard del Club</h1>  
                <div id="warningAlert" style="display: none;"></div>  
                <div class="data-grid">  
                    <div class="data-box">  
                        <div class="data-label">Posici√≥n</div>  
                        <div class="data-value" id="dashPos">-</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Puntos</div>  
                        <div class="data-value" id="dashPts">0</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">PJ</div>  
                        <div class="data-value" id="dashPJ">0</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Goles</div>  
                        <div class="data-value" id="dashGoals">0</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Jugadores</div>  
                        <div class="data-value" id="dashSquad">0</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Juveniles</div>  
                        <div class="data-value" id="dashAcademy">0</div>  
                    </div>  
                </div>  
                <h2>Estado Financiero</h2>  
                <table>  
                    <tr><td>Dinero en Caja:</td><td id="dashBalance">0‚Ç¨</td></tr>  
                    <tr><td>Ingresos Semanales:</td><td id="dashIncome">0‚Ç¨</td></tr>  
                    <tr><td>Gastos Semanales:</td><td id="dashExpenses">0‚Ç¨</td></tr>  
                    <tr><td>Balance Semanal:</td><td id="dashWeekly" class="data-value">+0‚Ç¨</td></tr>  
                </table>  
            </div>  
  
            <!-- CLASIFICACI√ìN -->  
            <div id="standings" class="page">  
                <h1>üìà Clasificaci√≥n Liga</h1>  
                <table>  
                    <thead><tr><th>Pos</th><th>Equipo</th><th>PJ</th><th>G</th><th>E</th><th>P</th><th>GF</th><th>GC</th><th>DG</th><th>Pts</th></tr></thead>  
                    <tbody id="standingsTable"></tbody>  
                </table>  
            </div>  
  
            <!-- PLANTILLA -->  
            <div id="squad" class="page">  
                <h1>üë• Plantilla</h1>  
                <button class="btn" onclick="openModal('signPlayer')">+ Fichar Jugador</button>  
                <div id="squadList" style="margin-top: 20px;"></div>  
            </div>  
  
            <!-- MERCADO -->  
            <div id="transfers" class="page">  
                <h1>üîÑ Mercado de Fichajes</h1>  
                <div class="alert alert-info">üí° Busca talentos j√≥venes para comprar barato y revender caro, o refuerza tu equipo.</div>  
                <button class="btn" onclick="openModal('signPlayer')">Ver Jugadores Disponibles</button>  
                <div id="transferMarket" style="margin-top: 20px;">  
                    <!-- Los jugadores disponibles se renderizar√°n en el modal, no aqu√≠ directamente -->  
                </div>  
            </div>  
  
            <!-- CANTERA -->  
            <div id="academy" class="page">  
                <h1>üéì Academia y Cantera</h1>  
                <button class="btn" onclick="openModal('signYoungster')">+ Contratar Joven</button>  
                <div id="academyList" style="margin-top: 20px;"></div>  
            </div>  
  
            <!-- T√ÅCTICAS -->  
            <div id="tactics" class="page">  
                <h1>üéØ T√°cticas</h1>  
                <div class="form-group" style="margin: 20px 0;">  
                    <label style="display: block; margin-bottom: 5px;">Formaci√≥n:</label>  
                    <select id="formationSelect" onchange="updateFormation()">  
                        <option value="433">4-3-3 Equilibrada</option>  
                        <option value="442">4-4-2 Cl√°sica</option>  
                        <option value="352">3-5-2 Ofensiva</option>  
                        <option value="541">5-4-1 Defensiva</option>  
                        <option value="451">4-5-1 Mixta</option>  
                    </select>  
                    <label style="display: block; margin-top: 15px; margin-bottom: 5px;">Mentalidad:</label>  
                    <select id="mentalitySelect" onchange="updateMentality()">  
                        <option value="defensive">Defensiva</option>  
                        <option value="balanced" selected>Equilibrada</option>  
                        <option value="offensive">Ofensiva</option>  
                    </select>  
                </div>  
            </div>  
  
            <!-- PR√ìXIMO PARTIDO -->  
            <div id="match" class="page">  
                <h1>‚öΩ Simular Jornada</h1>  
                <div id="matchInfo" style="margin: 30px 0;">  
                    <!-- Aqu√≠ se mostrar√° la informaci√≥n del pr√≥ximo partido -->  
                </div>  
                <button class="btn" onclick="simulateWeek()">Simular Jornada Completa</button>  
                <div id="lastMatchResult" style="margin-top: 20px;"></div>  
            </div>  
  
            <!-- FINANZAS -->  
            <div id="finance" class="page">  
                <h1>üíº Finanzas</h1>  
                <div class="data-grid">  
                    <div class="data-box">  
                        <div class="data-label">Ingresos/Semana</div>  
                        <div class="data-value" id="financeWeeklyIncome">0‚Ç¨</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Gastos/Semana</div>  
                        <div class="data-value negative" id="financeWeeklyExpenses">0‚Ç¨</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Balance Actual</div>  
                        <div class="data-value" id="financeBalance">0‚Ç¨</div>  
                    </div>  
                </div>  
                <h2>Detalle de Ingresos</h2>  
                <table>  
                    <tr><td>Capacidad Estadio:</td><td id="financeStadiumCapacity">0</td></tr>  
                    <tr><td>Asistencia Esperada:</td><td id="financeExpectedAttendance">0</td></tr>  
                    <tr><td>Precio Entrada:</td><td><input type="number" id="ticketPriceInput" min="5" max="100" onchange="setTicketPriceFromInput()">‚Ç¨</td></tr>  
                    <tr><td>Popularidad del Club:</td><td id="financePopularity">0%</td></tr>  
                    <tr><td>Fanbase:</td><td id="financeFanbase">0</td></tr>  
                    <tr><td>Merchandising vendido:</td><td id="financeMerchandisingItemsSold">0</td></tr>  
                    <tr><td>Precio Merchandising:</td><td><input type="number" id="merchandisingPriceInput" min="1" max="50" onchange="setMerchandisingPriceFromInput()">‚Ç¨</td></tr>  
                    <tr><td>Ingresos Merchandising:</td><td id="financeMerchandisingRevenue">0‚Ç¨</td></tr>  
                </table>  
            </div>  
  
            <!-- INSTALACIONES -->  
            <div id="facilities" class="page">  
                <h1>üèüÔ∏è Instalaciones</h1>  
                <h2>Estadio</h2>  
                <p>Capacidad actual: <span id="currentStadiumCapacity">0</span></p>  
                <button class="btn" onclick="expandStadium()">Expandir Estadio (+10.000 asientos - 50.000‚Ç¨)</button>  
                <h2>Centro de Entrenamiento</h2>  
                <p>Nivel actual: <span id="currentTrainingLevel">1</span></p>  
                <button class="btn" onclick="improveFacilities()">Mejorar Entrenamientos (30.000‚Ç¨)</button>  
            </div>  
  
            <!-- COMERCIAL (Nueva secci√≥n) -->  
            <div id="commercial" class="page">  
                <h1>üõí Gesti√≥n Comercial</h1>  
                <div class="data-grid">  
                    <div class="data-box">  
                        <div class="data-label">Popularidad del Club</div>  
                        <div class="data-value" id="commercialPopularity">0%</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Base de Fans</div>  
                        <div class="data-value" id="commercialFanbase">0</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Merchandising Vendido (semana)</div>  
                        <div class="data-value" id="commercialItemsSold">0</div>  
                    </div>  
                    <div class="data-box">  
                        <div class="data-label">Ingresos Merchandising (semana)</div>  
                        <div class="data-value" id="commercialMerchRevenue">0‚Ç¨</div>  
                    </div>  
                </div>  
                <h2>Ajustes Comerciales</h2>  
                <p>Ajusta el precio de tus entradas y merchandising para maximizar beneficios. Ten en cuenta que precios muy altos pueden reducir la popularidad y la asistencia.</p>  
                <div style="margin-top: 20px;">  
                    <label style="display: block; margin-bottom: 5px;">Precio de la Entrada (actual: <span id="currentTicketPrice">0</span>‚Ç¨):</label>  
                    <input type="range" id="ticketPriceSlider" min="5" max="100" value="20" oninput="updateTicketPriceDisplay(this.value)" onchange="setTicketPriceFromSlider(this.value)">  
                    <span id="ticketPriceSliderValue">20</span>‚Ç¨  
                </div>  
                <div style="margin-top: 15px;">  
                    <label style="display: block; margin-bottom: 5px;">Precio del Merchandising (actual: <span id="currentMerchandisingPrice">0</span>‚Ç¨):</label>  
                    <input type="range" id="merchandisingPriceSlider" min="1" max="50" value="10" oninput="updateMerchandisingPriceDisplay(this.value)" onchange="setMerchandisingPriceFromSlider(this.value)">  
                    <span id="merchandisingPriceSliderValue">10</span>‚Ç¨  
                </div>  
            </div>  
  
  
            <!-- STAFF -->  
            <div id="staff" class="page">  
                <h1>üëî Personal del Club</h1>  
                <table>  
                    <tr><td>üè• M√©dico</td><td id="staffMedico"></td><td><button class="btn btn-sm" id="btnHireMedico" onclick="hireStaff('medico')"></button></td></tr>  
                    <tr><td>üß™ Entrenador F√≠sico</td><td id="staffEntrenador"></td><td><button class="btn btn-sm" id="btnHireEntrenador" onclick="hireStaff('entrenador')"></button></td></tr>  
                    <tr><td>üé¨ Analista V√≠deo</td><td id="staffAnalista"></td><td><button class="btn btn-sm" id="btnHireAnalista" onclick="hireStaff('analista')"></button></td></tr>  
                    <tr><td>üîç Scout</td><td id="staffScout"></td><td><button class="btn btn-sm" id="btnHireScout" onclick="hireStaff('scout')"></button></td></tr>  
                    <tr><td>‚úçÔ∏è Secretario T√©cnico</td><td id="staffSecretario"></td><td><button class="btn btn-sm" id="btnHireSecretario" onclick="hireStaff('secretario')"></button></td></tr>  
                </table>  
            </div>  
  
            <!-- OPCIONES -->  
            <div id="settings" class="page">  
                <h1>‚öôÔ∏è Opciones</h1>  
                <button class="btn" onclick="saveGame()">üíæ Guardar Partida</button>  
                <button class="btn" onclick="loadGame()">üìÇ Cargar Partida</button>  
                <button class="btn" style="background: #c73446; margin-top: 20px;" onclick="resetGame()">üîÑ Reiniciar</button>  
            </div>  
        </div>  
    </div>  
  
    <!-- MODALES -->  
    <div id="gameModeModal" class="modal">  
        <div class="modal-content">  
            <span class="modal-close" onclick="closeModal('gameMode')">&times;</span>  
            <h1>Modo de Juego</h1>  
            <button class="btn" style="width: 100%; padding: 20px; margin-top: 20px;" onclick="startGameMode('manager')">üèÖ Liga Manager (Empezar con equipo preexistente)</button>  
            <button class="btn" style="width: 100%; padding: 20px; margin-top: 20px;" onclick="startGameMode('promanager')">üöÄ Liga Promanager (Empezar desde abajo)</button>  
        </div>  
    </div>  
  
    <div id="selectTeamModal" class="modal">  
        <div class="modal-content">  
            <span class="modal-close" onclick="closeModal('selectTeam')">&times;</span>  
            <h1>Selecciona tu Equipo</h1>  
            <h2>Primera Divisi√≥n</h2>  
            <div id="primeraList" class="team-selection-list"></div>  
            <h2>Segunda Divisi√≥n</h2>  
            <div id="segundaList" class="team-selection-list"></div>  
            <h2>Primera RFEF</h2>  
            <div id="rfefList" class="team-selection-list"></div>  
        </div>  
    </div>  
  
    <div id="signPlayerModal" class="modal">  
        <div class="modal-content">  
            <span class="modal-close" onclick="closeModal('signPlayer')">&times;</span>  
            <h1>Fichar Jugador</h1>  
            <div id="availablePlayersList"></div>  
        </div>  
    </div>  
  
    <div id="signYoungsterModal" class="modal">  
        <div class="modal-content">  
            <span class="modal-close" onclick="closeModal('signYoungster')">&times;</span>  
            <h1>Contratar Joven</h1>  
            <div id="availableYoungstersList"></div>  
        </div>  
    </div>  
  
    <script type="module">  
        import * as gameLogic from './gameLogic.js';  
        import * as ui from './ui.js';  
        import { TEAMS_DATA, FORMATIONS } from './config.js'; // Importar FORMATIONS tambi√©n  
        import { generateAvailablePlayers, generateAvailableYoungsters } from './players.js';  
  
        // --- Funciones globales expuestas para el HTML ---  
        // Se a√±ade `window.negotiatePlayer` como placeholder para eliminar el error.  
        window.negotiatePlayer = function(playerName) {  
            alert(`Funcionalidad de negociaci√≥n para ${playerName} no implementada a√∫n.`);  
            console.log(`Intentando negociar con ${playerName}`);  
        };  
  
        window.switchPage = function(pageId, element) {  
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));  
            document.getElementById(pageId).classList.add('active');  
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));  
            element.classList.add('active');  
  
            const state = gameLogic.getGameState();  
            if (pageId === 'squad') ui.renderSquadList(state.squad, state.team);  
            if (pageId === 'academy') ui.renderAcademyList(state.academy);  
            if (pageId === 'transfers') renderAvailablePlayers();  
            if (pageId === 'match') {  
                const rivals = Object.keys(state.standings).filter(t => t !== state.team);  
                const nextRival = rivals.length > 0 ? rivals[Math.floor(Math.random() * rivals.length)] : 'Equipo IA';  
                ui.renderNextMatchCard(state.team, nextRival, state.week);  
                document.getElementById('lastMatchResult').innerHTML = '';  
                const lastMatch = state.matchHistory[state.matchHistory.length - 1];  
                if (lastMatch) {  
                    document.getElementById('lastMatchResult').innerHTML = `  
                        <div class="alert alert-info">√öltimo resultado: ${lastMatch.home} ${lastMatch.score} ${lastMatch.away}</div>  
                    `;  
                }  
            }  
            if (pageId === 'finance') updateFinanceDisplay(state);  
            if (pageId === 'facilities') updateFacilitiesDisplay(state);  
            if (pageId === 'commercial') updateCommercialDisplay(state); // Nueva funci√≥n para la secci√≥n comercial  
            if (pageId === 'staff') updateStaffDisplay(state);  
            if (pageId === 'tactics') updateTacticsDisplay(state);  
        };  
  
        window.openModal = function(type) {  
            if (type === 'gameMode') {  
                document.getElementById('gameModeModal').classList.add('active');  
            } else if (type === 'selectTeam') {  
                document.getElementById('selectTeamModal').classList.add('active');  
                renderTeamSelectors();  
            } else if (type === 'signPlayer') {  
                document.getElementById('signPlayerModal').classList.add('active');  
                renderAvailablePlayers();  
            } else if (type === 'signYoungster') {  
                document.getElementById('signYoungsterModal').classList.add('active');  
                renderAvailableYoungsters();  
            }  
        };  
  
        window.closeModal = function(type) {  
            document.getElementById(type + 'Modal').classList.remove('active');  
        };  
  
        window.startGameMode = function(mode) {  
            window.gameMode = mode;  
            window.closeModal('gameMode');  
            window.openModal('selectTeam');  
        };  
  
        function renderTeamSelectors() {  
            const createTeamButtons = (divisionKey) => {  
                const listElement = document.getElementById(`${divisionKey}List`);  
                if (!listElement) return;  
  
                listElement.innerHTML = TEAMS_DATA[divisionKey].map(team =>  
                    `<button class="btn" style="width: 100%; margin: 5px 0; background: rgba(233, 69, 96, 0.1); border-color: #e94560; color: #fff;" onclick="selectTeamAndStart('${team}', '${divisionKey}')">  
                        ${team}  
                    </button>`  
                ).join('');  
            };  
  
            createTeamButtons('primera');  
            createTeamButtons('segunda');  
            createTeamButtons('rfef');  
        }  
  
        window.selectTeamAndStart = function(teamName, division) {  
            gameLogic.selectTeamWithInitialSquad(teamName, division, window.gameMode);  
            ui.refreshUI(gameLogic.getGameState());  
            window.closeModal('selectTeam');  
            const dashboardButton = document.querySelector('.menu-item[onclick="switchPage(\'dashboard\', this)"]');  
            if(dashboardButton) {  
                window.switchPage('dashboard', dashboardButton);  
            }  
        };  
  
        function renderAvailablePlayers() {  
            const players = generateAvailablePlayers();  
            ui.renderAvailablePlayersMarket(players);  
        }  
  
        function renderAvailableYoungsters() {  
            const youngsters = generateAvailableYoungsters();  
            ui.renderAvailableYoungstersMarket(youngsters);  
        }  
  
        window.fichPlayerConfirm = function(encodedPlayerJson) {  
            const player = JSON.parse(decodeURIComponent(encodedPlayerJson));  
            const result = gameLogic.signPlayer(player);  
            if (result.success) {  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
                window.closeModal('signPlayer');  
            } else {  
                alert('Error: ' + result.message);  
            }  
        };  
  
        window.fichYoungsterConfirm = function(encodedYoungsterJson) {  
            const youngster = JSON.parse(decodeURIComponent(encodedYoungsterJson));  
            const result = gameLogic.signYoungster(youngster);  
            if (result.success) {  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
                window.closeModal('signYoungster');  
            } else {  
                alert('Error: ' + result.message);  
            }  
        };  
  
        window.sellPlayerConfirm = function(name) {  
            if (confirm(`¬øEst√°s seguro de que quieres vender a ${name}?`)) {  
                const result = gameLogic.sellPlayer(name);  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
            }  
        };  
  
        window.promoteConfirm = function(name) {  
            if (confirm(`¬øAscender a ${name} a la primera plantilla?`)) {  
                const result = gameLogic.promoteYoungster(name);  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
            }  
        };  
  
        window.simulateWeek = function() {  
            gameLogic.simulateFullWeek();  
            const state = gameLogic.getGameState();  
            ui.refreshUI(state);  
  
            const lastMatch = state.matchHistory[state.matchHistory.length - 1];  
            if (lastMatch) {  
                document.getElementById('lastMatchResult').innerHTML = `  
                    <div class="alert alert-info">√öltimo resultado: ${lastMatch.home} ${lastMatch.score} ${lastMatch.away}</div>  
                `;  
            }  
        };  
  
        window.updateFormation = function() {  
            const state = gameLogic.getGameState();  
            const newFormation = document.getElementById('formationSelect').value;  
            const updatedState = { ...state, formation: newFormation };  
            gameLogic.updateGameState(updatedState);  
            alert('Formaci√≥n actualizada a ' + FORMATIONS[updatedState.formation].name);  
        };  
  
        window.updateMentality = function() {  
            const state = gameLogic.getGameState();  
            const newMentality = document.getElementById('mentalitySelect').value;  
            const updatedState = { ...state, mentality: newMentality };  
            gameLogic.updateGameState(updatedState);  
            alert('Mentalidad t√°ctica actualizada a ' + updatedState.mentality);  
        };  
  
        function updateTacticsDisplay(state) {  
             const formationSelect = document.getElementById('formationSelect');  
             const mentalitySelect = document.getElementById('mentalitySelect');  
             if(formationSelect) formationSelect.value = state.formation;  
             if(mentalitySelect) mentalitySelect.value = state.mentality;  
        }  
  
        window.expandStadium = function() {  
            const result = gameLogic.expandStadium();  
            alert(result.message);  
            ui.refreshUI(gameLogic.getGameState());  
            updateFacilitiesDisplay(gameLogic.getGameState());  
        };  
  
        window.improveFacilities = function() {  
            const result = gameLogic.improveFacilities();  
            alert(result.message);  
            ui.refreshUI(gameLogic.getGameState());  
            updateFacilitiesDisplay(gameLogic.getGameState());  
        };  
  
        function updateFacilitiesDisplay(state) {  
            const currentStadiumCapacity = document.getElementById('currentStadiumCapacity');  
            const currentTrainingLevel = document.getElementById('currentTrainingLevel');  
            if (currentStadiumCapacity) currentStadiumCapacity.textContent = state.stadiumCapacity.toLocaleString('es-ES');  
            if (currentTrainingLevel) currentTrainingLevel.textContent = state.trainingLevel;  
        }  
  
        window.hireStaff = function(role) {  
            const result = gameLogic.hireStaff(role);  
            alert(result.message);  
            ui.refreshUI(gameLogic.getGameState());  
            updateStaffDisplay(gameLogic.getGameState());  
        };  
  
        function updateStaffDisplay(state) {  
            const staffRoles = ['medico', 'entrenador', 'analista', 'scout', 'secretario'];  
            staffRoles.forEach(role => {  
                const staffElement = document.getElementById(`staff${role.charAt(0).toUpperCase() + role.slice(1)}`);  
                const btnElement = document.getElementById(`btnHire${role.charAt(0).toUpperCase() + role.slice(1)}`);  
  
                if (staffElement) staffElement.textContent = state.staff[role] ? 'Contratado' : 'No contratado';  
                if (btnElement) {  
                    btnElement.disabled = state.staff[role] !== null;  
                    btnElement.textContent = state.staff[role] !== null ? 'Contratado' : 'Contratar';  
                }  
            });  
        }  
  
        // --- Nuevas funciones para la secci√≥n comercial ---  
        window.setTicketPriceFromInput = function() {  
            const input = document.getElementById('ticketPriceInput');  
            const newPrice = input.value;  
            const result = gameLogic.setTicketPrice(newPrice);  
            if (result.success) {  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
                updateFinanceDisplay(gameLogic.getGameState()); // Actualizar finanzas  
                updateCommercialDisplay(gameLogic.getGameState()); // Actualizar comercial  
            } else {  
                alert('Error: ' + result.message);  
                input.value = gameLogic.getGameState().ticketPrice; // Revertir valor  
            }  
        };  
  
        window.setMerchandisingPriceFromInput = function() {  
            const input = document.getElementById('merchandisingPriceInput');  
            const newPrice = input.value;  
            const result = gameLogic.setMerchandisingPrice(newPrice);  
            if (result.success) {  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
                updateFinanceDisplay(gameLogic.getGameState()); // Actualizar finanzas  
                updateCommercialDisplay(gameLogic.getGameState()); // Actualizar comercial  
            } else {  
                alert('Error: ' + result.message);  
                input.value = gameLogic.getGameState().merchandisingPrice; // Revertir valor  
            }  
        };  
  
        window.updateTicketPriceDisplay = function(value) {  
            document.getElementById('ticketPriceSliderValue').textContent = value;  
        };  
  
        window.setTicketPriceFromSlider = function(value) {  
            const result = gameLogic.setTicketPrice(value);  
            if (result.success) {  
                ui.refreshUI(gameLogic.getGameState());  
                updateFinanceDisplay(gameLogic.getGameState());  
                // No alert, ya que el slider es interactivo  
            } else {  
                alert('Error: ' + result.message);  
                document.getElementById('ticketPriceSlider').value = gameLogic.getGameState().ticketPrice;  
                document.getElementById('ticketPriceSliderValue').textContent = gameLogic.getGameState().ticketPrice;  
            }  
        };  
  
        window.updateMerchandisingPriceDisplay = function(value) {  
            document.getElementById('merchandisingPriceSliderValue').textContent = value;  
        };  
  
        window.setMerchandisingPriceFromSlider = function(value) {  
            const result = gameLogic.setMerchandisingPrice(value);  
            if (result.success) {  
                ui.refreshUI(gameLogic.getGameState());  
                updateFinanceDisplay(gameLogic.getGameState());  
                // No alert, ya que el slider es interactivo  
            } else {  
                alert('Error: ' + result.message);  
                document.getElementById('merchandisingPriceSlider').value = gameLogic.getGameState().merchandisingPrice;  
                document.getElementById('merchandisingPriceSliderValue').textContent = gameLogic.getGameState().merchandisingPrice;  
            }  
        };  
  
  
        function updateFinanceDisplay(state) {  
            document.getElementById('financeWeeklyIncome').textContent = state.weeklyIncome.toLocaleString('es-ES') + '‚Ç¨';  
            document.getElementById('financeWeeklyExpenses').textContent = state.weeklyExpenses.toLocaleString('es-ES') + '‚Ç¨';  
            document.getElementById('financeBalance').textContent = state.balance.toLocaleString('es-ES') + '‚Ç¨';  
            document.getElementById('financeStadiumCapacity').textContent = state.stadiumCapacity.toLocaleString('es-ES');  
  
            // Calcular asistencia esperada para mostrar en finanzas  
            let expectedAttendance = Math.floor(state.stadiumCapacity * (0.5 + (state.popularity / 200) - (state.ticketPrice / 100)));  
            expectedAttendance = Math.max(0, Math.min(state.stadiumCapacity, expectedAttendance));  
            document.getElementById('financeExpectedAttendance').textContent = expectedAttendance.toLocaleString('es-ES');  
  
            document.getElementById('ticketPriceInput').value = state.ticketPrice;  
            document.getElementById('financePopularity').textContent = state.popularity + '%';  
            document.getElementById('financeFanbase').textContent = state.fanbase.toLocaleString('es-ES');  
            document.getElementById('financeMerchandisingItemsSold').textContent = state.merchandisingItemsSold.toLocaleString('es-ES');  
            document.getElementById('merchandisingPriceInput').value = state.merchandisingPrice;  
            document.getElementById('financeMerchandisingRevenue').textContent = state.merchandisingRevenue.toLocaleString('es-ES') + '‚Ç¨';  
        }  
  
        function updateCommercialDisplay(state) {  
            document.getElementById('commercialPopularity').textContent = state.popularity + '%';  
            document.getElementById('commercialFanbase').textContent = state.fanbase.toLocaleString('es-ES');  
            document.getElementById('commercialItemsSold').textContent = state.merchandisingItemsSold.toLocaleString('es-ES');  
            document.getElementById('commercialMerchRevenue').textContent = state.merchandisingRevenue.toLocaleString('es-ES') + '‚Ç¨';  
  
            // Actualizar sliders y sus valores  
            const ticketPriceSlider = document.getElementById('ticketPriceSlider');  
            const merchandisingPriceSlider = document.getElementById('merchandisingPriceSlider');  
  
            if (ticketPriceSlider) {  
                ticketPriceSlider.value = state.ticketPrice;  
                document.getElementById('currentTicketPrice').textContent = state.ticketPrice;  
                document.getElementById('ticketPriceSliderValue').textContent = state.ticketPrice;  
            }  
            if (merchandisingPriceSlider) {  
                merchandisingPriceSlider.value = state.merchandisingPrice;  
                document.getElementById('currentMerchandisingPrice').textContent = state.merchandisingPrice;  
                document.getElementById('merchandisingPriceSliderValue').textContent = state.merchandisingPrice;  
            }  
        }  
  
  
        // --- Guardado y Carga ---  
        window.saveGame = function() {  
            const result = gameLogic.saveToLocalStorage();  
            alert(result.message);  
        };  
  
        window.loadGame = function() {  
            const result = gameLogic.loadFromLocalStorage();  
            if (result.success) {  
                alert(result.message);  
                ui.refreshUI(gameLogic.getGameState());  
                const dashboardButton = document.querySelector('.menu-item[onclick="switchPage(\'dashboard\', this)"]');  
                if(dashboardButton) {  
                    window.switchPage('dashboard', dashboardButton);  
                }  
            } else {  
                alert(result.message);  
            }  
        };  
  
        window.resetGame = function() {  
            if (confirm('¬øEst√°s seguro de que quieres reiniciar completamente el juego? Toda tu partida se perder√°.')) {  
                gameLogic.resetGame();  
            }  
        };  
  
        // --- Inicializaci√≥n del juego ---  
        document.addEventListener('DOMContentLoaded', () => {  
            const savedStateResult = gameLogic.loadFromLocalStorage();  
            if (savedStateResult.success) {  
                ui.refreshUI(gameLogic.getGameState());  
                const dashboardButton = document.querySelector('.menu-item[onclick="switchPage(\'dashboard\', this)"]');  
                if(dashboardButton) {  
                    window.switchPage('dashboard', dashboardButton);  
                }  
            } else {  
                window.openModal('gameMode');  
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));  
            }  
        });  
    </script>  
</body>  
</html>  
